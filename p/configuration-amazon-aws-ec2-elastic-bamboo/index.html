<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="alternate" type="application/rss+xml" title="Thomas Belin's Blog" href="https://blog.atomrc.dev/feed.xml"><link rel="icon" href="/favicon.ico"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><title>Configuration d'une instance Amazon EC2 pour Elastic Bamboo - Thomas Belin</title><meta name="description" content="Tutoriel d'installation d'une instance EC2 pour faire de l'intégration continue avec Bamboo"><meta name="author" content="Thomas Belin"><link rel="canonical" href="https://blog.atomrc.dev/p/configuration-amazon-aws-ec2-elastic-bamboo/"><meta property="og:title" content="Configuration d'une instance Amazon EC2 pour Elastic Bamboo - Thomas Belin"><meta property="og:description" content="Tutoriel d'installation d'une instance EC2 pour faire de l'intégration continue avec Bamboo"><meta property="og:url" content="https://blog.atomrc.dev/p/configuration-amazon-aws-ec2-elastic-bamboo/"><meta property="og:image" content="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@atomrc"><meta name="twitter:title" content="Configuration d'une instance Amazon EC2 pour Elastic Bamboo - Thomas Belin"><meta name="twitter:description" content="Tutoriel d'installation d'une instance EC2 pour faire de l'intégration continue avec Bamboo"><meta name="twitter:image" content="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc"><meta name="color-scheme" content="dark light"><style>body{--ff-sans:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Ubuntu","Roboto","Noto Sans","Droid Sans",sans-serif;--ff-mono:ui-monospace,"Cascadia Mono","Segoe UI Mono","Ubuntu Mono","Roboto Mono",Menlo,Monaco,Consolas,monospace;padding:0;margin:0;color:var(--font-color);background-color:var(--bg-color);font-family:var(--ff-sans);font-size:13pt}body,body.light-mode{--font-color:#333;--font-secondary-color:#555;--bg-color:#fff;--title-color:#e7005d;--link-color:#0e4db5;--bg-code-color:#f6f6f6;--secondary-color:#eee}body.dark-mode{--font-color:#ddd;--font-secondary-color:#aaa;--bg-color:#1c1c21;--title-color:var(--link-color);--link-color:rgb(88, 166, 255);--bg-code-color:#444;--secondary-color:#333}#dark-mode-toggle{border:none;background-color:transparent;position:fixed;top:1em;right:1em;z-index:1;height:24px;width:24px;overflow:hidden}#dark-mode-toggle svg{stroke:var(--font-color);fill:var(--font-color);transition:opacity .3s,fill .3s,stroke .3s;position:absolute;top:0;left:0}.dark-mode #dark-mode-toggle .moon,.light-mode #dark-mode-toggle .sun{opacity:0}a{text-decoration:none;color:var(--link-color)}ul{list-style:none;padding:0}.avatar{height:100px;width:100px;border-radius:50px}.title{color:var(--title-color)}.tag{font-size:10pt;color:var(--font-secondary-color);font-style:italic}#header{text-align:center;font-size:1.95em;padding:1em}#header .title{color:var(--font-color);font-weight:200}#footer{text-align:center;padding:2em}.love{color:red}#footer a{color:inherit;text-decoration:underline}</style><script async defer="defer" data-domain="atomrc.dev" src="https://plausible.io/js/plausible.js"></script></head><body><button id="dark-mode-toggle" aria-label="Toggle bewteen dark and light mode"><svg xmlns="http://www.w3.org/2000/svg" class="sun" stroke-linejoin="round" stroke-linecap="round" stroke-width="2" stroke="#000" fill="none" height="24" width="24"><circle r="5" cy="12" cx="12"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72 1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" class="moon"><path style="stroke-width:.0469517" d="M13.278 24.02c3.707 0 7.093-1.687 9.336-4.451a.564.564 0 0 0-.543-.909c-5.831 1.111-11.186-3.36-11.186-9.247a9.41 9.41 0 0 1 4.765-8.188.564.564 0 0 0-.176-1.044 12.12 12.12 0 0 0-2.196-.2C6.643-.02 1.258 5.356 1.258 12c0 6.635 5.376 12.02 12.02 12.02z"/></svg></button><script>(function (win, doc) {
  let isDarkMode =
    sessionStorage.getItem("darkmode") === undefined
      ? win.matchMedia("(prefers-color-scheme: dark)").matches
      : sessionStorage.getItem("darkmode") === "true";

  const toggleDarkMode = (setDarkMode) => {
    isDarkMode = setDarkMode ?? !isDarkMode;
    sessionStorage.setItem("darkmode", isDarkMode);
    if (isDarkMode) {
      document.body.classList.add("dark-mode");
      document.body.classList.remove("light-mode");
    } else {
      document.body.classList.remove("dark-mode");
      document.body.classList.add("light-mode");
    }
  };

  toggleDarkMode(isDarkMode);
  const darkModeToggle = doc.getElementById("dark-mode-toggle");

  darkModeToggle.addEventListener("click", () => toggleDarkMode());
})(window, document);</script><div id="header"><div><a href="/"><img class="avatar" src="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=200" alt="Avatar"></a><br><a class="title" href="/"><span rel="author">Thomas Belin</span></a><br></div></div><section><link href="/css/article.css" rel="stylesheet" async defer="defer"><link href="/css/syntax.css" rel="stylesheet" async defer="defer"><style>article{max-width:800px;margin:auto;padding:0 1em;position:relative;line-height:1.5em}article h1{font-size:2em;font-weight:300;line-height:1.2em}article h2,article h3{position:relative;padding-bottom:.3em;font-weight:500;line-height:1.2em}article h2{font-size:2em;border-bottom:solid 1px var(--secondary-color);margin:1em 0 .5em}article h3{font-size:1.5em;margin:1em 2em}article ul{list-style-type:disc;padding:0 2em}article picture{border:solid 1px grey;display:block;max-width:100%;margin:auto}picture img,video{width:100%;height:auto}</style><article lang="fr"><header><h1 class="title">Configuration d'une instance Amazon EC2 pour Elastic Bamboo</h1><aside><time class="folded-paper" datetime="2014-04-11T00:00:00.000Z" pubdate itemprop="datePublished" content="2014-04-11T00:00:00.000Z">11 <span class="month">Apr</span> 2014</time><br><span class="tag">posts</span>&nbsp; <span class="tag">bamboo</span>&nbsp; <span class="tag">aws</span>&nbsp; <span class="tag">integration continue</span>&nbsp;</aside></header><div class="article-body"><p>Lors de la mise en place de Bamboo comme serveur d'<a href="/p/integration-continue-avec-bamboo/">intégration continue à DoYouBuzz</a>, la phase qui m'a semblé la plus obscure a été la phase de configuration de mon instance AWS EC2. La <a href="https://confluence.atlassian.com/display/BAMBOO/Configuring+Elastic+Bamboo">documentation d'Altassian sur Elastic Bamboo</a> est vraiment très fournie et même surement un peu trop, la rendant parfois confuse. Voici donc un petit tutoriel qui devrait vous permettre d'avoir un petit serveur d'intégration continue rapidement.</p><h2 id="tl%3Bdr%3B" tabindex="-1">TL;DR;</h2><p>En gros :</p><ul><li>la liaison entre Amazon et Bamboo est très facile à faire ;</li><li>la documentation de Bamboo est beaucoup trop fournie pour s'y retrouver ;</li><li>pour voir les images pré-configurées pour Bamboo, attention à être dans la région <code>US East (Nothern Virginia)</code> ;</li><li>la création d'une image avec les paquets dont on a besoin c'est très facile une fois qu'on a compris le principe ;</li><li>attention au type d'instance que vous associez aux images, seul le type <code>micro</code> fait partie de l'offre gratuite sur Amazon.</li></ul><h2 id="pourquoi-elastic-bamboo" tabindex="-1">Pourquoi Elastic Bamboo</h2><p>Avec Bamboo, on avez deux possibilités :</p><ul><li>soit vous installez Bamboo sur un serveur à vous, dans quel cas l'intégration continue se fera sur le même serveur que celui sur lequel vous aurez installé Bamboo ;</li><li>soit vous utilisez Bamboo en <a href="http://fr.wikipedia.org/wiki/Logiciel_en_tant_que_service">SasS</a> dans quel cas Bamboo utilisera une instance EC2 sur le cloud d'Amazon pour faire vos builds. C'est ce cas là dont nous parlerons ici.</li></ul><h2 id="liaison-entre-amazon-aws-et-bamboo" tabindex="-1">Liaison entre Amazon AWS et Bamboo</h2><h3 id="c%C3%B4t%C3%A9-amazon" tabindex="-1">Côté Amazon</h3><p>Vous l'aurez compris, pour continuer ce tuto, il va nous falloir un compte Amazon sur lequel seront crées vos instances EC2. Je ne vous ferais pas l’affront de vous dire comment passer cette étape, je vous laisse directement aller <a href="http://aws.amazon.com/fr/ec2/">là</a>.</p><p>Une fois qu'on a notre compte, il va falloir générer une clé d'accès à ce compte. Cela permettra à Bamboo de créer/détruire des instances pour lancer vos builds. Pour cela on va se rendre dans la partie identification de votre compte Amazon :</p><p><img src="//i.imgur.com/9WV1O5v.png" alt="aws-credentials"></p><p>Ca se passe dans la partie &quot;Access Keys&quot;. Là, on va pouvoir générer une paire de clés pour notre serveur bamboo :</p><p><img src="//i.imgur.com/zuv28d9.png" alt="aws-access-key"></p><p>Il ne faut pas oublier de copier les clés avant de fermer la popup ! Ensuite, on va pouvoir passer à Bamboo.</p><h3 id="c%C3%B4t%C3%A9-bamboo" tabindex="-1">Côté Bamboo</h3><p>De mémoire, quand vous avez une utilisation SaaS de Bamboo, vous ne pourrez pas accéder à l'interface d'administration tant que vous n'aurez pas renseigné vos clés d'accès à Amazon AWS. Il vous suffit donc de renseigner les clés que vous aurez générées à l'étape précédente.</p><p>Voila maintenant Bamboo va pouvoir communiquer avec AWS. Et oui c'est aussi simple que ça. Mais c'est aussi là ou les choses se compliquent.</p><h2 id="cr%C3%A9ation-d'une-image-ec2-pour-bamboo" tabindex="-1">Création d'une image EC2 pour Bamboo</h2><p>Jusque là, tout était plutôt facile. La création d'une image a été la première étape sur laquelle j'ai vraiment bloqué. En sois le processus n'est pas très compliqué, mais la documentation est tellement fournie qu'on a l'impression qu'il faut être admin système senior pour pouvoir faire ça. Or pas du tout, quelques notions suffisent !</p><p>Ce que j'ai mis du temps à comprendre c'est <strong>qu'on a deux possibilités pour créer nos images</strong> :</p><ul><li>partir d'une image complètement vierge sur laquelle on installe et on configure tous les paquets nécessaires pour que bamboo fonctionne (la version bien barbue) ;</li><li>partir d'une image fournie par Bamboo qui a déjà toutes les configurations par défaut pour Bamboo sur laquelle on va ajouter tous les paquets dont on a besoin pour jouer nos tests (si seulement j'avais compris plus tôt que cette solution existait :) ).</li></ul><p>La question qui se pose à ce moment là c'est : Pourquoi je n'avais pas vu qu'il y avait des images configurées pour Bamboo ? Pourtant j'avais été voir dans l'onglet des images dans la configuration de Bamboo, il n'y avait rien ! La réponse est simple : <strong>on ne voit ces images si, et seulement si, on a configuré la région <code>US East (Nothern Virginia)</code> dans les préférences globales de Bamboo</strong> -_-.</p><p><img src="//i.imgur.com/IAoTahE.png" alt="bamboo-config-region"></p><p>Ensuite, si on va dans l'onglet &quot;Image Configuration&quot; sur l'admin Bamboo, on doit voir un certain nombre d'images disponibles :</p><p><img src="//i.imgur.com/B9H4SKq.png" alt="bamboo-pre-configured-instances"></p><p>Il va maintenant falloir nous en choisir une qu'on va customiser comme il se doit.</p><h3 id="pimp-my-image" tabindex="-1">Pimp My Image</h3><p>Voila les étapes de personnalisation d'une image Bamboo :</p><ul><li>on lance une instance de l'image qu'on a choisie précédemment ;</li><li>on se connecte dessus pour installer tous les paquets nécessaires ;</li><li>on créé, dans AWS, une nouvelle image à partir de l'instance personnalisés ;</li><li>rend cette image disponible dans Bamboo.</li></ul><p>Allez c'est parti !</p><p>Dans la liste des images disponibles, on démarre celle qu'on a choisie. On peut voir, dans l'onglet &quot;Instances&quot; de l'admin Bamboo qu'une instance est en train de démarrer à partir de l'image choisie. Une fois celle-ci démarrée (ça peut prendre un peu de temps hein), on va pouvoir se connecter dessus. On clique sur l'identifiant de l'instance pour accéder à ses informations :</p><p><img src="//i.imgur.com/zj7W6Oy.png" alt="instance-details"></p><p>Dans la section &quot;SSH access&quot; on va pouvoir télécharger la clé privée qui nous donnera accès à votre instance puis se connecter à cette dernière via une commande qui est donnée.</p><p>Pour pouvoir installer des paquet sur votre instance, on a besoin des droits <code>root</code> donc dans la commande qui est donnée, on remplace <code>ec2-user</code> par <code>root</code>. Ce qui devrait donner quelque chose comme :</p><pre><code>ssh -i /path/to/private/key.pk root@ec2-xxxxxxxx.compute-1.amazonaws.com
</code></pre><p>Il est également nécessaire de jouer la commande <code>chmod 400 path/to/private/key.pk</code> avant cette commande sinon Amazon refusera l'accès !</p><p>C'est le moment où on installe tous les paquets dont on a besoin pour lancer les builds du projet !!</p><p>Une fois les installations finies, il ne reste plus qu'à créer une nouvelle image à partir de l'instance qui tourne sur Amazon :</p><p><img src="//i.imgur.com/X3peG12.png" alt="create-image-amazon-instance"></p><p>Toujours sur Amazon, on peut aller dans l'onglet <code>Images &gt; AMIs</code> et noter l'identifiant de l'image que l'on vient de créer. Ca doit ressembler à <code>ami-XXXXXXXX</code></p><p>Retour sur l'interface de Bamboo, on va pouvoir créer une nouvelle image. Rien de bien sorcier, il suffit de bien mettre l'identifiant de l'image qu'on a créée juste avant pour que le lien se fasse bien. <strong>Attention, si vous êtes sur une offre gratuite, à bien mettre <code>micro</code> dans le champ &quot;instance type&quot;</strong>, les autres sont hors du compte gratuit Amazon !</p><h2 id="conclusion" tabindex="-1">Conclusion</h2><p>Arrivé ici, on a réussi à configurer une image système sur Amazon qui va nous permettre de jouer les builds de notre projet automatiquement. Je vous propose donc de passer à la suite :</p><ul><li><a href="/p/lancer-des-tests-atoum-dans-bamboo/">Bamboo et les tests Atoum</a> ;</li><li>jouer et interpréter des tests Karma dans Bamboo (en cours d'écriture).</li></ul></div><br><em>You enjoyed this article? Consider <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/tweet?url=https://blog.atomrc.dev/p/configuration-amazon-aws-ec2-elastic-bamboo/&text=Configuration d'une instance Amazon EC2 pour Elastic Bamboo&via=atomrc">tweeting it</a> :)</em></article><script src="/js/posts.js" async></script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "https://blog.atomrc.dev#website",
      "url": "https://blog.atomrc.dev",
      "name": "Thomas Belin",
      "description": "Freelance Front-End Architect in Paris. I leave code cleaner than I found it. Seriously into Functional and Reactive Programming.",
      "inLanguage": "fr"
    },
    {
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.atomrc.dev/p/configuration-amazon-aws-ec2-elastic-bamboo/"
      },
      "url": "https://blog.atomrc.dev/p/configuration-amazon-aws-ec2-elastic-bamboo/",
      "isPartOf": {
        "@id": "https://blog.atomrc.dev#website"
      },
      "headline": "Configuration d'une instance Amazon EC2 pour Elastic Bamboo",
      "description": "Tutoriel d'installation d'une instance EC2 pour faire de l'intégration continue avec Bamboo",
      "image": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
      "inLanguage": "fr",
      "publisher": {
        "@type": "Organization",
        "name": "Thomas Belin",
        "url": "https://blog.atomrc.dev#organization",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
          "width": 300,
          "height": 300
        }
      },
      "author": {
        "@type": "Person",
        "name": "Thomas Belin"
      },
      "keywords": "posts,bamboo,aws,integration continue",
      "datePublished": "2014-04-11T00:00:00.000Z"
    }
  ]
}</script></section><div id="footer">Made with <span class="love">♥</span>️ by <a href="https://twitter.com/atomrc" rel="noopener noreferrer">@atomrc</a></div></body></html>