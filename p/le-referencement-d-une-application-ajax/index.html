<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="alternate" type="application/rss+xml" title="Thomas Belin's Blog" href="https://blog.atomrc.dev/feed.xml"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><title>Le r&eacute;f&eacute;rencement d&apos;une application Ajax - Thomas Belin</title><meta name="description" content="Donnez aux moteurs de recherche le moyen de crawler votre application ajax"><meta name="robots" content="index,follow"><meta name="author" content="Thomas Belin"><link rel="canonical" href="https://blog.atomrc.dev/p/le-referencement-d-une-application-ajax/"><meta property="og:title" content="Le r&eacute;f&eacute;rencement d&apos;une application Ajax - Thomas Belin"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.atomrc.dev/p/le-referencement-d-une-application-ajax/"><meta property="og:description" content="Donnez aux moteurs de recherche le moyen de crawler votre application ajax"><meta property="og:image" content="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@atomrc"><meta name="twitter:url" content="https://blog.atomrc.dev/p/le-referencement-d-une-application-ajax/"><meta name="twitter:title" content="Le r&eacute;f&eacute;rencement d&apos;une application Ajax - Thomas Belin"><meta name="twitter:description" content="Donnez aux moteurs de recherche le moyen de crawler votre application ajax"><meta name="twitter:image" content="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300"><meta name="theme-color" content="#ffffff"><style>body{--ff-sans:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Ubuntu","Roboto","Noto Sans","Droid Sans",sans-serif;--ff-mono:ui-monospace,"Cascadia Mono","Segoe UI Mono","Ubuntu Mono","Roboto Mono",Menlo,Monaco,Consolas,monospace;padding:0;margin:0;color:#333;background-color:#fff;font-family:var(--ff-sans);font-size:13pt}a{text-decoration:none;color:#0e4db5}ul{list-style:none;padding:0}.avatar{height:100px;width:100px;border-radius:50px}.title{color:#e7005d}.tag{font-size:10pt;color:#888;font-style:italic}#header{text-align:center;font-size:1.95em;padding:1em}#header .title{text-shadow:1px 1px 0 #fff;color:inherit;font-weight:200}#footer{background-color:#5986d1;color:#fff;text-align:center;padding:1em}#footer a{color:#010733}</style><script async defer="defer" data-domain="atomrc.dev" src="https://plausible.io/js/plausible.js"></script></head><body><div id="header"><div><a href="/"><img class="avatar" src="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=200" alt="Avatar"></a><br><a class="title" href="/"><span rel="author">Thomas Belin</span></a><br></div></div><section><link href="/css/article.css" rel="stylesheet" async defer="defer"><link href="/css/syntax.css" rel="stylesheet" async defer="defer"><style>article{max-width:800px;margin:auto;padding:0 1em;position:relative}article h1{font-size:2em;font-weight:300}article h2,article h3{position:relative;padding-bottom:.3em;font-weight:500}article h2{font-size:2em;border-bottom:solid 1px #eee;margin:1em 0 .5em}article h3{font-size:1.5em;margin:1em 2em}article p{line-height:1.6em}article img{border:solid 1px grey;display:block;max-width:90%;margin:auto}</style><article lang="fr"><header><h1 class="title">Le référencement d'une application Ajax</h1><aside><time class="folded-paper" datetime="Fri Mar 15 2013 00:00:00 GMT+0000 (Coordinated Universal Time)" pubdate itemprop="datePublished" content="Fri Mar 15 2013 00:00:00 GMT+0000 (Coordinated Universal Time)">15 <span class="month">Mar</span> 2013</time><br><span class="tag">posts</span>&nbsp; <span class="tag">ajax</span>&nbsp; <span class="tag">seo</span>&nbsp;</aside></header><div class="article-body"><p>Quand vous faites un blog, ce que vous allez vouloir garder en tête c'est : comment être bien référencé sur les moteurs de recherche. En temps normal, votre premier travail consisterait à faire : du contenu de qualité, ajouter de la <a href="http://googlewebmastercentral.blogspot.fr/2012/07/on-web-semantics.html">sémantique</a> à vos articles pour être &quot;compris&quot; des moteurs, optimiser les performances, mettre des liens vers votre sites sur tout le web ...</p><p>C'est très bien mais, dans le cas d'une application Ajax, tout cela ne sert strictement à rien si votre contenu n'est pas accessible sans Javascript.</p><p>Pour le référencement de mon blog et la rédaction de cet article je me suis très fortement inspiré de l'<a href="https://developers.google.com/webmasters/ajax-crawling/">article de Google sur le référencement d'une application Ajax</a>. Le moteur privilégié dont je parlerai dans cet article sera donc Google, mais ces pratiques sont censées s'appliquer aux principaux moteurs.</p><h2 id="a-savoir-sur-l'indexation-(google)">A savoir sur l'indexation (Google)</h2><p>Vous l'aurez sûrement compris, il y a un hic quand il s'agit d'indexer des applications chargeant les données en Ajax. Le &quot;pourquoi&quot; est simple : les robots des moteurs n'ont pas de moteur Javascript actif. Ils ne pourront donc que lire le HTML brut que le serveur envoie. Or, bien souvent (et c'est le cas de mon blog) le seul HTML pur qu'une application Ajax envoie est le layout global de l'application. Voila ce que verrait un moteur de recherche qui visiterait n'importe laquelle des pages de mon blog : mon blog sans JavascriptMon blog chargé en désactivant Javascript Pas forcément très intéressant pour le référencement, vous me l'accorderez.</p><p>Il va donc falloir servir le squelette vide de l'application aux visiteurs et des pages HTML complètes aux robots des moteurs. Ne vous en faites il est possible d'indiquer au robot qui indexe votre application que le contenu est chargé en Ajax.</p><h2 id="renseigner-les-robots-sur-la-nature-de-votre-application">Renseigner les robots sur la nature de votre application</h2><p>Dans l'immédiat, ce qu'on veut c'est pouvoir savoir quand un robot de Google vient demander notre application. Seulement il n'y a pas de moyen vraiment fiable pour savoir si le visiteur actuel est une personne ou un robot. Il y a bien les <a href="http://fr.wikipedia.org/wiki/User-Agent">user agent</a> mais il changent d'un moteur à l'autre et rien ne vous dit qu'il restera tout le temps le même. Impossible de se baser là dessus. La solution consiste à indiquer au moteur de recherche que votre application est Ajax pour que quand il interroge votre serveur il lui dise que lui est un robot. Pour faire ça, rien de plus simple, il suffit de mettre un <code>hashbang</code> (<code>#!</code>) dans vos urls.</p><p>Dans votre sitemap.xml, il faudra donc que vos urls contiennent toutes le fameux hashbang (par exemple <code>/#!/post</code>) afin que le moteur qui vous indexe sache que les données sont chargées via Ajax. Le cas particulier de la page d'accueil</p><p>Bien souvent l'url de votre page d'accueil ressemble plutôt à 'http://blog.thomasbelin.fr/' que 'http://thomasbelin.fr/#!/'. Seulement le problème ici est que l'url n'indique pas que les données sont chargées en Ajax. Pour cela il vous faudra ajouter dans l'entête de votre layout HTML, la balise méta suivante :</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fragment<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>!<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>Ainsi le moteur de recherche qui indexera cette page va refaire un requête vers cette même url mais en considérant qu'il y a un hashbang à la fin.</p><h2 id="bien-r%C3%A9pondre-au-robot-d'indexation">Bien répondre au robot d'indexation</h2><p>A ce niveau, nous savons comment faire savoir au robot que votre application charge ses données en Ajax. Du côté de notre serveur il faut faire deux choses : détecter quand un robot demande l'application et lui répondre en conséquence.</p><h3 id="d%C3%A9tecter-le-robot-...">Détecter le robot ...</h3><p>Grâce aux urls hachées, le robot va modifier sa façon de requêter votre serveur en remplaçant tous les <code>#!</code> par <code>?_escaped_fragment_=</code>. Ainsi au lieu d'interroger notre serveur avec <code>http://thomasbelin.fr/#!/posts</code> il va le faire avec <code>http://thomasbelin.fr/?_escaped_fragment_=/posts</code> De votre côté, votre serveur recevra donc un paramètre <code>GET</code> contenant les paramètres hachés de vos urls. Vous êtes donc sûr que quand la requête contient le paramètre <code>GET</code> <code>_escaped_fragment_</code> c'est un robot qui vous demande la page. Libre à vous ensuite de faire de l'Url Rewriting ou simplement interpréter le paramètre pour router les demandes du robot.</p><h3 id="...-et-lui-r%C3%A9pondre">... Et lui répondre</h3><p>Pour la réponse, rien de plus simple, il suffit de renvoyer une page HTML statique contenant toutes les données qui sont normalement chargées en Ajax par vos clients.</p><p>La partie la plus délicate vient ensuite : générer les pages HTML statiques qui seront envoyées au robot d'indexation.</p><h2 id="g%C3%A9n%C3%A9rer-des-snapshots-de-l'application">Générer des snapshots de l'application</h2><p>Comme on l'a dit plus haut, le robot n'a pas de Javascript activé, il faut donc que toutes les données soient dans la page qu'on envoie du serveur. Cependant ces pages doivent être exactement ce que voit un utilisateur une fois que les données sont chargées ! L'idée va donc être de générer des snapshots de l'application qui seront envoyés aux robots. Pour cela, il y a plusieurs solutions possibles :</p><ul><li>faire une version statique de votre application ;</li><li>faire générer des snapshots par ses visiteurs et automatiser la génération des snapshots via un navigateur headless.</li></ul><p>Nous allons mettre de côté la première solution (faire une version statique de l'application) qui demande de coder tout deux fois et devient rapidement impossible à maintenir.</p><h3 id="faire-g%C3%A9n%C3%A9rer-les-snapshots-par-vos-visiteurs">Faire générer les snapshots par vos visiteurs</h3><p>Ce n'est pas forcément la solution idéale, mais c'est celle que j'ai adoptée pour mon blog pour une raison simple : je suis limité sur mon serveur et ne peux pas installer de navigateur headless. J'ai donc choisi de faire bosser vos navigateurs à la place :). Pour cela, et grâce à AngularJS, j'ai placé un callback sur l'événement de chargement d'un état de l'application. Cela donne :</p><pre class="language-javascript"><code class="language-javascript">$rootScope<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'$viewContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    window<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>takeSnapshot<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Je met également un timeout d'une seconde pour être tout à fait sûr qu'il n'y a pas d'animation en cours lors de l'envoi du snapshot. Et voila donc la fonction qui fait le snapshot et le sauvegarde sur le serveur :</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">takeSnapshot</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">//wrapping the full document in an angular element</span><br>    <span class="token keyword">var</span> content <span class="token operator">=</span> Angular<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">//sending the generated snapshot to the server</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'html'</span><span class="token operator">:</span> content<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'page'</span><span class="token operator">:</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>J'envois donc le HTML brut généré par le navigateur client ainsi que la page actuelle au serveur via une requête <code>POST</code>. Côté serveur, il me suffit de sauvegarder le fichier HTML correspondant avec une arborescence liée à la page visitée. De cette façon quand un robot d'indexation demande cette page, mon serveur lui enverra ce fichier HTML.</p><p>cette solution, présente deux intérêts particuliers :</p><ul><li>elle est très simple à mettre en place ;</li><li>elle ne consomme (quasiment) aucune ressource côté serveur.</li></ul><p>Mais cette solution n'est pas idéale et son principal défaut est que <strong>les clients peuvent tout à fait vous envoyer n'importe quoi</strong> ! Ca peut s'avérer être un très gros problème si jamais vous tombez face à quelqu'un de mal intentionné qui pourra alors envoyer des données fausses à votre serveur (je travaille à sécuriser ce processus. Si vous avez des idées, je suis preneur). En bref, si vous avez les moyens d'utiliser un navigateur headless, faites le !</p><h3 id="utiliser-un-navigateur-headless">Utiliser un navigateur headless</h3><p>Je ne pourrais que très peu vous parler de cette solution dans la mesure où je n'ai pas pu la mettre en place personnellement. Aussi je vous renvoie vers la <a href="https://developers.google.com/webmasters/ajax-crawling/docs/html-snapshot">documentation de Google sur ce sujet</a>. L'idée principale est que quand un robot demande un état de votre application, le navigateur headless va d'abord s'occuper du chargement de l'état avec ses données puis envoyer le résultat au robot. C'est clairement la solution la plus optimale pour la génération de snapshots.</p><h2 id="conclusion">Conclusion</h2><p>Le référencement est une raison pour laquelle le développement d'une application Ajax demande un peu plus d'investissement qu'un site web. Cependant, une fois votre système de snapshots mis en place, vous n'aurez plus jamais à vous en préoccuper et il ne vous restera plus qu'a faire de beaux contenus...</p></div><br><em>You enjoyed this article? Consider <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/tweet?url=https://blog.atomrc.dev/p/le-referencement-d-une-application-ajax/&text=Le référencement d'une application Ajax&via=atomrc">tweeting it</a> :)</em></article><script src="/js/application.js" async></script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "https://blog.atomrc.dev#website",
      "url": "https://blog.atomrc.dev",
      "name": "Thomas Belin",
      "description": "Senior Front-End Architect @deezer in Paris. I leave code cleaner than I found it. Seriously into Functional and Reactive Programming.",
      "inLanguage": "fr"
    },
    {
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.atomrc.dev/p/le-referencement-d-une-application-ajax/"
      },
      "url": "https://blog.atomrc.dev/p/le-referencement-d-une-application-ajax/",
      "isPartOf": {
        "@id": "https://blog.atomrc.dev#website"
      },
      "headline": "Le référencement d'une application Ajax",
      "description": "Donnez aux moteurs de recherche le moyen de crawler votre application ajax",
      "image": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
      "inLanguage": "fr",
      "publisher": {
        "@type": "Organization",
        "name": "Thomas Belin",
        "url": "https://blog.atomrc.dev",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
          "width": 300,
          "height": 300
        }
      },
      "author": {
        "@type": "Person",
        "name": "Thomas Belin"
      },
      "keywords": "posts,ajax,seo",
      "datePublished": "2013-03-15T00:00:00.000Z"
    }
  ]
}</script></section><div id="footer"><address>Senior Front-End Engineer <a href="https://deezer.com" target="_blank" rel="noreferrer noopener">@deezer</a> in Paris.<br>I leave code cleaner than I found it.<br>I tweet (<a href="https://twitter.com/atomrc" target="_blank" rel="noreferrer noopener">@atomrc</a>) and I code (<a href="https://github.com/atomrc" target="_blank" rel="noreferrer noopener">atomrc</a>)<br>I help (<a href="https://stackoverflow.com/users/2745879/atomrc" target="_blank" rel="noreferrer noopener">S.O profile</a>)</address></div></body></html>