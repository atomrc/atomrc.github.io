<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="alternate" type="application/rss+xml" title="Thomas Belin's Blog" href="https://blog.atomrc.dev/feed.xml"><link rel="icon" href="/favicon.ico"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><title>Compiling your TypeScript library (2023 edition) - Thomas Belin</title><meta name="description" content="A quick comparison of the tools available for building TypeScript libraries in 2023: tsup, swc, esbuild and tsc"><meta name="author" content="Thomas Belin"><link rel="canonical" href="https://blog.atomrc.dev/p/typescript-library-compilation-2023/"><meta property="og:title" content="Compiling your TypeScript library (2023 edition) - Thomas Belin"><meta property="og:description" content="A quick comparison of the tools available for building TypeScript libraries in 2023: tsup, swc, esbuild and tsc"><meta property="og:url" content="https://blog.atomrc.dev/p/typescript-library-compilation-2023/"><meta property="og:image" content="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@atomrc"><meta name="twitter:title" content="Compiling your TypeScript library (2023 edition) - Thomas Belin"><meta name="twitter:description" content="A quick comparison of the tools available for building TypeScript libraries in 2023: tsup, swc, esbuild and tsc"><meta name="twitter:image" content="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc"><meta name="color-scheme" content="dark light"><style>body{--ff-sans:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Ubuntu","Roboto","Noto Sans","Droid Sans",sans-serif;--ff-mono:ui-monospace,"Cascadia Mono","Segoe UI Mono","Ubuntu Mono","Roboto Mono",Menlo,Monaco,Consolas,monospace;padding:0;margin:0;color:var(--font-color);background-color:var(--bg-color);font-family:var(--ff-sans);font-size:13pt}body,body.light-mode{--font-color:#333;--font-secondary-color:#555;--bg-color:#fff;--title-color:#e7005d;--link-color:#0e4db5;--bg-code-color:#f6f6f6;--secondary-color:#eee}body.dark-mode{--font-color:#ddd;--font-secondary-color:#aaa;--bg-color:#1c1c21;--title-color:var(--link-color);--link-color:rgb(88, 166, 255);--bg-code-color:#444;--secondary-color:#333}#dark-mode-toggle{border:none;background-color:transparent;position:fixed;top:1em;right:1em;z-index:1;height:24px;width:24px;overflow:hidden}#dark-mode-toggle svg{stroke:var(--font-color);fill:var(--font-color);transition:opacity .3s,fill .3s,stroke .3s;position:absolute;top:0;left:0}.dark-mode #dark-mode-toggle .moon,.light-mode #dark-mode-toggle .sun{opacity:0}a{text-decoration:none;color:var(--link-color)}ul{list-style:none;padding:0}.avatar{height:100px;width:100px;border-radius:50px}.title{color:var(--title-color)}.title a{color:inherit}.list-title{font-size:1.2em;font-weight:400;margin:.1em}aside{padding-left:.5em;font-size:.8em}#header{text-align:center;font-size:1.95em;padding:1em}#header nav{text-align:center;margin-top:.6em;font-size:.5em}#header .title{color:var(--font-color);font-weight:200}footer{text-align:center;padding:2em}.love{color:red}footer a{color:inherit;text-decoration:underline}.list-container{max-width:50%;margin:auto;text-align:center}@media screen and (max-width:1000px){.list-container{max-width:75%}}@media screen and (max-width:650px){.list-container{max-width:80%}}.list-container__title{text-align:center}.list-container__list li{padding-bottom:.5em}.list-container__headline{max-width:500px}.list-container__content{display:inline-block;text-align:left}</style><script async defer="defer" data-domain="atomrc.dev" src="https://plausible.io/js/plausible.js"></script></head><body><button id="dark-mode-toggle" aria-label="Toggle bewteen dark and light mode"><svg xmlns="http://www.w3.org/2000/svg" class="sun" stroke-linejoin="round" stroke-linecap="round" stroke-width="2" stroke="#000" fill="none" height="24" width="24"><circle r="5" cy="12" cx="12"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72 1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" class="moon"><path style="stroke-width:.0469517" d="M13.278 24.02c3.707 0 7.093-1.687 9.336-4.451a.564.564 0 0 0-.543-.909c-5.831 1.111-11.186-3.36-11.186-9.247a9.41 9.41 0 0 1 4.765-8.188.564.564 0 0 0-.176-1.044 12.12 12.12 0 0 0-2.196-.2C6.643-.02 1.258 5.356 1.258 12c0 6.635 5.376 12.02 12.02 12.02z"/></svg></button><script>(function (win, doc) {
  let isDarkMode =
    sessionStorage.getItem("darkmode") === undefined
      ? win.matchMedia("(prefers-color-scheme: dark)").matches
      : sessionStorage.getItem("darkmode") === "true";

  const toggleDarkMode = (setDarkMode) => {
    isDarkMode = setDarkMode ?? !isDarkMode;
    sessionStorage.setItem("darkmode", isDarkMode);
    if (isDarkMode) {
      document.body.classList.add("dark-mode");
      document.body.classList.remove("light-mode");
    } else {
      document.body.classList.remove("dark-mode");
      document.body.classList.add("light-mode");
    }
  };

  toggleDarkMode(isDarkMode);
  const darkModeToggle = doc.getElementById("dark-mode-toggle");

  darkModeToggle.addEventListener("click", () => toggleDarkMode());
})(window, document);</script><section id="header"><div><a href="/"><img class="avatar" src="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=200" alt="Avatar"></a><br><a class="title" href="/"><span rel="author">Thomas Belin</span></a><br></div><nav><a href="/about/">About Me</a></nav></section><section><link href="/css/article.css" rel="stylesheet" async defer="defer"><link href="/css/syntax.css" rel="stylesheet" async defer="defer"><style>article{max-width:800px;margin:auto;padding:0 1em;position:relative;line-height:1.5em}article h1{font-size:2em;font-weight:300;line-height:1em}article h2,article h3{position:relative;padding-bottom:.3em;font-weight:500;line-height:1.2em}article h2{font-size:2em;border-bottom:solid 1px var(--secondary-color);margin:1em 0 .5em}article h3{font-size:1.5em;margin:1em 1em}article ul{list-style-type:disc;padding:0 2em}article picture{border:solid 1px grey;display:block;max-width:100%;margin:auto}picture img,video{width:100%;height:auto}</style><article lang="en"><header><h1 class="title">Compiling your TypeScript library (2023 edition)</h1><aside>üè∑Ô∏è <span class="tag">posts</span>&nbsp; <span class="tag">typescript</span>&nbsp; <span class="tag">library</span>&nbsp; <span class="tag">compiler</span>&nbsp;<br><time datetime="2023-01-21T00:00:00.000Z" pubdate itemprop="datePublished" content="2023-01-21T00:00:00.000Z">üìÜ 21&nbsp;Jan&nbsp;23</time></aside></header><div class="article-body"><style>.winner {color: green;}
    .loser {color: red;}</style><p>When we talk about compling TypeScript projects there are usually two different contexts that are often mixed together: compiling a library vs compiling an application.</p><p>Those two contexts have slightly different constraints and need to be considered separately.</p><p>Today I'm going to focus on <strong>compiling a TypeScript library into a JavaScript package</strong> :)</p><h2 id="the-wishlist" tabindex="-1">The wishlist</h2><p>In order to build a nice library that is suited for most projects, we want our package to be:</p><ul><li>type-checked when consumed in a TypeScript project;</li><li>consumable in both <code>commonjs</code> and <code>esmodule</code> projects.</li></ul><p>According to those wishes, we need to:</p><ul><li>generate and package the declaration files (<code>.d.ts</code>);</li><li>be able to compile for different module targets.</li></ul><h2 id="considered-solutions" tabindex="-1">Considered solutions</h2><p>Today, we are going to benchmark the following solutions:</p><ul><li><a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">tsc</a> - the native TypeScript compiler</li><li><a href="https://esbuild.github.io/">esbuild</a> - a full-fledged bundler and superfast compiler written in <code>go</code></li><li><a href="https://swc.rs/">swc</a> - a full-fledged bundler and superfast compiler written in <code>rust</code></li><li><a href="tsup.egoist.dev/">tsup</a> - a TypeScript library builder based on <code>esbuild</code></li></ul><p>Side note: I have excluded tools that are only bundlers (<code>webpack</code>, <code>rollup</code>, ...) and <code>babel</code> which was superseded by <code>swc</code> and <code>esbuild</code>.</p><table><thead><tr><th>compiler</th><th><code>d.ts</code> generation</th><th>multiple module targets</th></tr></thead><tbody><tr><td>esbuild</td><td>‚ùå</td><td>‚ùå</td></tr><tr><td>swc</td><td>‚ùå</td><td>‚ùå</td></tr><tr><td>tsc</td><td>‚úÖ</td><td>‚ùå</td></tr><tr><td>tsup</td><td>‚úÖ</td><td>‚úÖ</td></tr></tbody></table><p>By comparing features, there is already something that stands out: <strong>only <code>tsup</code> can generate declarations files (<code>.d.ts</code>) and target multiple package type out of the box</strong>.</p><p>This is not a showstopper, though!<br>Nothing is preventing us from running the compilation twice for different module targets.<br>And for the <code>d.ts</code> generation, we could rely on <code>tsc --emitDeclarationOnly</code> to generate them for us. (Both are actually what <code>tsup</code> is doing under the hood).<br>It's worth noting that those processes do not step on each other's toes, so we could run both compilation in parallel :)</p><p>Here would be the equivalent commands for all the tools we are going to evaluate:</p><p><strong>esbuild</strong></p><pre class="language-sh"><code class="language-sh">esbuild src/*.ts <span class="token parameter variable">--format</span><span class="token operator">=</span>esm <span class="token parameter variable">--outdir</span><span class="token operator">=</span>./lib/esm <span class="token operator">&amp;</span><br>esbuild src/*.ts <span class="token parameter variable">--format</span><span class="token operator">=</span>cjs <span class="token parameter variable">--outdir</span><span class="token operator">=</span>./lib/cjs <span class="token operator">&amp;</span><br>tsc <span class="token parameter variable">--emitDeclarationOnly</span> <span class="token parameter variable">--outDir</span> ./lib/types</code></pre><p><strong>tsup</strong></p><pre class="language-sh"><code class="language-sh">tsup src/*.ts <span class="token parameter variable">--format</span> esm,cjs <span class="token parameter variable">--dts</span> <span class="token parameter variable">-d</span><span class="token operator">=</span>./lib</code></pre><p><strong>swc</strong></p><pre class="language-sh"><code class="language-sh">swc <span class="token parameter variable">-C</span> <span class="token assign-left variable">module.type</span><span class="token operator">=</span>es6 src/*.ts <span class="token parameter variable">-d</span> ./lib/esm <span class="token operator">&amp;</span><br>swc <span class="token parameter variable">-C</span> <span class="token assign-left variable">module.type</span><span class="token operator">=</span>commonjs src/*.ts <span class="token parameter variable">-d</span> ./lib/cjs <span class="token operator">&amp;</span><br>tsc <span class="token parameter variable">--emitDeclarationOnly</span> <span class="token parameter variable">--outDir</span> ./lib/types</code></pre><p><strong>tsc</strong></p><pre class="language-sh"><code class="language-sh">tsc <span class="token parameter variable">--module</span> esnext <span class="token parameter variable">--outDir</span> ./lib/esm <span class="token operator">&amp;</span><br>tsc <span class="token parameter variable">--module</span> commonjs <span class="token parameter variable">--outDir</span> ./lib/cjs</code></pre><h2 id="benchmark" tabindex="-1">Benchmark</h2><p>This benchmark will be all but scientific!<br>I just tested compiling a library that has a single TypeScript file on Github CI. Every compiler is run 30 times, which mean we have very little samples.<br>This is just to give us a rough idea of how they could perform.<br>Please take this benchmark with a grain of salt!</p><p>(Here are the <a href="https://github.com/atomrc/ts-lib-benchmark">benchmark sources</a> and the <a href="https://github.com/atomrc/ts-lib-benchmark/actions">results on Github Actions</a>)</p><table><thead><tr><th>compiler</th><th>min</th><th>mean</th><th>max</th></tr></thead><tbody><tr><td>esbuild</td><td><span class="winner">1704ms</span></td><td><span class="winner">1812ms</span></td><td>2365ms</td></tr><tr><td>swc</td><td>1794ms</td><td>1855ms</td><td><span class="winner">1908ms</span></td></tr><tr><td>tsup</td><td>2001ms</td><td>2034ms</td><td>2085ms</td></tr><tr><td>tsc</td><td><span class="loser">2160ms</span></td><td><span class="loser">2215ms</span></td><td><span class="loser">2420ms</span></td></tr></tbody></table><p>Just to highlight how generating <code>d.ts</code> with <code>tsc</code> is costly, here is the same benchmark in which we skip generating declaration files:</p><table><thead><tr><th>compiler (no <code>d.ts</code>)</th><th>min</th><th>mean</th><th>max</th></tr></thead><tbody><tr><td>esbuild</td><td><span class="winner">414ms</span></td><td><span class="winner">427ms <span></span></span></td><td><span class="winner">500ms</span></td></tr><tr><td>swc</td><td>537ms</td><td>550ms</td><td>570ms</td></tr><tr><td>tsup</td><td>559ms</td><td>570ms</td><td>587ms</td></tr><tr><td>tsc</td><td><span class="loser">2119ms</span></td><td><span class="loser">2196ms</span></td><td><span class="loser">2783ms</span></td></tr></tbody></table><p>This is an order of magnitude different, but we can note that <code>tsc</code> is performing pretty much the same when not asked to generate types.</p><p>There is no obvious winner between <code>swc</code>, <code>esbuild</code> and <code>tsup</code>, but we can see that <code>tsc</code> is outperformed.</p><h2 id="conclusion" tabindex="-1">Conclusion</h2><p>One sad realization that I had while putting up together this benchmark is that <strong>no matter how fast the compiler is, it's always going to be at least as slow as <code>tsc --emitDeclarationOnly</code></strong>.</p><p>My personnal benchark isn't really significant when it comes to performances comparisons... But we can clearly identify that <code>tsc</code> is the looser!</p><p>Now, with its built-in support for declaration files generation and multiple targets in my opinion <strong><code>tsup</code> is the winner! It is tailored for building libraries!</strong><br>Having only a single command to write to compile our libraries means it easier for maintenance and if, in the future, <code>tsup</code> figure out a way to generate <code>d.ts</code> files faster we will benefit from it by upgrading our local version.</p></div><br><em>You enjoyed this article? Consider <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/tweet?url=https://blog.atomrc.dev/p/typescript-library-compilation-2023/&text=Compiling your TypeScript library (2023 edition)&via=atomrc">tweeting it</a> :)</em></article><script src="/js/posts.js" async></script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "https://blog.atomrc.dev#website",
      "url": "https://blog.atomrc.dev",
      "name": "Thomas Belin",
      "description": "Freelance Front-End Architect in Paris. I leave code cleaner than I found it. Seriously into Functional and Reactive Programming.",
      "inLanguage": "en"
    },
    {
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.atomrc.dev/p/typescript-library-compilation-2023/"
      },
      "url": "https://blog.atomrc.dev/p/typescript-library-compilation-2023/",
      "isPartOf": {
        "@id": "https://blog.atomrc.dev#website"
      },
      "headline": "Compiling your TypeScript library (2023 edition)",
      "description": "A quick comparison of the tools available for building TypeScript libraries in 2023: tsup, swc, esbuild and tsc",
      "image": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
      "inLanguage": "en",
      "publisher": {
        "@type": "Organization",
        "name": "Thomas Belin",
        "url": "https://blog.atomrc.dev#organization",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
          "width": 300,
          "height": 300
        }
      },
      "author": {
        "@type": "Person",
        "name": "Thomas Belin"
      },
      "keywords": "posts,typescript,library,compiler",
      "datePublished": "2023-01-21T00:00:00.000Z"
    }
  ]
}</script></section><footer>Made with <span class="love">‚ô•</span>Ô∏è by <a href="https://twitter.com/atomrc" rel="noopener noreferrer">@atomrc</a><br><a href="/feed.xml">RSS feed</a></footer></body></html>