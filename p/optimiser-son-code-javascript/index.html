<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="alternate" type="application/rss+xml" title="Thomas Belin's Blog" href="https://blog.atomrc.dev/feed.xml"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><title>Soigner son code Javascript - Thomas Belin</title><meta name="description" content="Javascript a &eacute;t&eacute; pr&eacute;vu pour &ecirc;tre un langage tr&egrave;s simple d&apos;acc&egrave;s au d&eacute;triment de ses performances. C&apos;est donc a vous de faire quelques efforts pour avoir un code optimis&eacute;"><meta name="robots" content="index,follow"><meta name="author" content="Thomas Belin"><link rel="canonical" href="https://blog.atomrc.dev/p/optimiser-son-code-javascript/"><meta property="og:title" content="Soigner son code Javascript - Thomas Belin"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.atomrc.dev/p/optimiser-son-code-javascript/"><meta property="og:description" content="Javascript a &eacute;t&eacute; pr&eacute;vu pour &ecirc;tre un langage tr&egrave;s simple d&apos;acc&egrave;s au d&eacute;triment de ses performances. C&apos;est donc a vous de faire quelques efforts pour avoir un code optimis&eacute;"><meta property="og:image" content="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@atomrc"><meta name="twitter:url" content="https://blog.atomrc.dev/p/optimiser-son-code-javascript/"><meta name="twitter:title" content="Soigner son code Javascript - Thomas Belin"><meta name="twitter:description" content="Javascript a &eacute;t&eacute; pr&eacute;vu pour &ecirc;tre un langage tr&egrave;s simple d&apos;acc&egrave;s au d&eacute;triment de ses performances. C&apos;est donc a vous de faire quelques efforts pour avoir un code optimis&eacute;"><meta name="twitter:image" content="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300"><meta name="theme-color" content="#ffffff"><style>body{--ff-sans:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Ubuntu","Roboto","Noto Sans","Droid Sans",sans-serif;--ff-mono:ui-monospace,"Cascadia Mono","Segoe UI Mono","Ubuntu Mono","Roboto Mono",Menlo,Monaco,Consolas,monospace;padding:0;margin:0;color:#333;background-color:#fff;font-family:var(--ff-sans);font-size:13pt}a{text-decoration:none;color:#0e4db5}ul{list-style:none;padding:0}.avatar{height:100px;width:100px;border-radius:50px}.title{color:#e7005d}.tag{font-size:10pt;color:#888;font-style:italic}#header{text-align:center;font-size:1.95em;padding:1em}#header .title{text-shadow:1px 1px 0 #fff;color:inherit;font-weight:200}#footer{background-color:#5986d1;color:#fff;text-align:center;padding:1em}#footer a{color:#010733}</style><script async defer="defer" data-domain="atomrc.dev" src="https://plausible.io/js/plausible.js"></script></head><body><div id="header"><div><a href="/"><img class="avatar" src="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=200" alt="Avatar"></a><br><a class="title" href="/"><span rel="author">Thomas Belin</span></a><br></div></div><section><link href="/css/article.css" rel="stylesheet" async defer="defer"><link href="/css/syntax.css" rel="stylesheet" async defer="defer"><style>article{max-width:800px;margin:auto;padding:0 1em;position:relative}article h1{font-size:2em;font-weight:300}article h2,article h3{position:relative;padding-bottom:.3em;font-weight:500}article h2{font-size:2em;border-bottom:solid 1px #eee;margin:1em 0 .5em}article h3{font-size:1.5em;margin:1em 2em}article p{line-height:1.6em}article img{border:solid 1px grey;display:block;max-width:90%;margin:auto}</style><article lang="fr"><header><h1 class="title">Soigner son code Javascript</h1><aside><time class="folded-paper" datetime="Sat Aug 24 2013 00:00:00 GMT+0000 (Coordinated Universal Time)" pubdate itemprop="datePublished" content="Sat Aug 24 2013 00:00:00 GMT+0000 (Coordinated Universal Time)">24 <span class="month">Aug</span> 2013</time><br><span class="tag">posts</span>&nbsp; <span class="tag">JavaScript</span>&nbsp; <span class="tag">Code</span>&nbsp; <span class="tag">Bonnes Pratiques</span>&nbsp;</aside></header><div class="article-body"><p>Javascript avait initialement été prévu pour être très facile d'accès. Seulement sa permissivité entraine également une réduction des performances globales et surtout la possibilité de faire du code très difficile à maintenir. Voila donc quelques conseils simples pour augmenter la lisibilité et la fiabilité de votre code et gagner un peu en performances.</p><h2 id="%22use-strict%22%3B">&quot;use strict&quot;;</h2><p>Si vous avez déjà lu le code de certaines librairies Javascript vous avez surement rencontré le <code>&quot;use strict&quot;</code>;. C'est le premier réflexe à avoir quand vous commencez un nouveau projet Javascript puisqu'il va dire au navigateur de ne pas laisser passer certaines aberrations normalement possibles avec Javascript.</p><h3 id="activer-le-mode-strict">Activer le mode strict</h3><p>Pour l'activer, rien de plus simple, il vous suffit de mettre le code suivant dans vos fichier js :</p><pre class="language-javascript"><code class="language-javascript"><span class="token string">"use strict"</span><span class="token punctuation">;</span></code></pre><p>Prudence car le <code>&quot;use strict&quot;</code> s'applique à tout le code qui est de même niveau d'imbrication ou inférieur. Ça veut dire que si vous le mettez directement à la racine d'un fichier js, il s'appliquera à tous les autres fichiers qui seront inclus pas la suite (librairies, autres fichiers à vous ...). Or ces fichiers ne respectent pas toujours le mode strict et engendreront des erreurs sur votre application.<br>Il est donc préférable de placer le <code>&quot;use strict&quot;</code> ; à l'intérieur des fonctions que vous écrivez.</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment">/* non strict */</span><br><br><span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token string">"use strict"</span><span class="token punctuation">;</span><br>    <span class="token comment">/* strict */</span><br><span class="token punctuation">}</span><br><br><span class="token comment">/* non strict */</span></code></pre><p>A quoi ça sert ?</p><p>Le <code>&quot;use strict&quot;</code>; va vous permettre de ne pas faire d'erreurs classiques et normalement autorisées par Javascript. Dans le mode strict, le navigateur va lancer des exceptions s'il rencontre du code non conforme. Voila ce que pourra vous éviter le mode strict :</p><ul><li>les variables déclarées sans le mot clé var (qui s'ajouteraient alors à l'objet global window);</li><li>l'utilisation des instructions <code>eval</code> et <code>with</code> ;</li><li>la déclaration d'un objet avec plusieurs fois la même propriété définie.</li></ul><p>Pour vraiment tout savoir sur le <code>&quot;use strict&quot;</code>, je vous suggère de lire absolument l'article &quot;<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/Strict_mode">strict mode</a>&quot; du Mozilla Developer Network sur le sujet !</p><h2 id="on-laisse-l'objet-global-window-tranquille">On laisse l'objet global window tranquille</h2><p>Vous le savez peut-être l'objet window est l'objet racine de tout le code Javascript (uniquement pour une application navigateur bien sûr). Pour garder votre application organisée et lisible par un autre développeur, il est préférable de ne pas surcharger cet objet. Pour cela, sachez que tout ce que vous définissez à la racine de vos fichiers js sera ajouté à l'objet window. Voila un exemple plus concret :</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token string">"test"</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>window<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> "test"</span></code></pre><p>Dans l'exemple, l'objet test est défini via le mot clé var mais tout de même ajouté à window.</p><p>Pour éviter de polluer l'objet global, il est souvent conseillé d'englober tout votre code dans une fonction qui sera exécutée immédiatement.</p><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <br>    <span class="token string">"use strict"</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token string">"value"</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//-> "value"</span><br><br>    <span class="token comment">/* code */</span><br><br><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token comment">//-> undefined</span></code></pre><p>Ainsi les variables que vous définirez dans le scope de cette fonction ne s'ajouteront pas au window. De cette façon vous maitrisez parfaitement ce que vous décidez de rendre global ou non. Ce schéma de construction s'appelle le Module Pattern. (merci @jrm2k6 pour la précision)</p><p>Si vous avez besoin d'une référence partagée pour toute l'application, vous n'avez qu'a définir une variable dans le scope global puis de la lire/écrire dans le code de votre application.</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> debug <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br><br><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <br>    <span class="token string">"use strict"</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//-> "debug"</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">/* code */</span><br><br><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token comment">//-> true</span></code></pre><p>Un autre confort que vous apporte la fonction wrapper est de pouvoir la portée du <code>&quot;use strict&quot;</code> sans avoir à le mettre dans chaque fonction que vous définissez. Tout ce que vous coderez dans le wrapper sera considéré strict et tout le reste non.</p><h2 id="injection-de-d%C3%A9pendances">Injection de dépendances</h2><p>L'injection de dépendances est une bonne pratique qui est utilisée dans bon nombre de frameworks (je pense par exemple à Symfony 2 pour PHP et AngularJS pour Javascript) et qui permet de rendre votre application très faiblement dépendante du contexte dans lequel elle s'exécute. La fonction wrapper que nous avons vu au dessus, va nous permettre de faire de l'injection de dépendances. Par exemple admettons que dans le code de votre application, vous ayez besoin de l'objet document, nous allons pouvoir injecter cet objet dans le wrapper de votre code.</p><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <br>    <span class="token string">"use strict"</span><span class="token punctuation">;</span><br><br>     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//-> "Optimiser son code Javascript"</span><br><br>    <span class="token comment">/* code */</span><br><br><span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>document<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Ainsi, si un jour vous décidez de créer un objet qui a le même prototype que document (pensez à un objet mocké pour les tests par exemple), vous n'avez qu'a changer le paramètre de la fonction wrapper. Tout le reste du code utilisera alors le nouvel objet sans que vous n'ayez rien d'autre à changer !</p><p>L'autre intérêt, spécifique au Javascript, va se trouver dans la minification de votre code. Si vous utilisez directement les objets du window, le compilateur ne pourra pas les réduire. En revanche, avec l'injection de dépendances, vous créez une référence (vers un objet global) qui peut être entièrement renommée par le compilateur. La version compilée du code précédent donnera alors :</p><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token string">"use strict"</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>document<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="connaitre-javascript">Connaitre Javascript</h2><p>Bon oui je sais ce point parait trivial, et pourtant, c'est le plus important ! C'est un point qui est valable pour n'importe quel langage dans lequel vous vous lancez. Vous mettrez peut-être 30min à comprendre la syntaxe du langage (faire des boucles, des conditions ...), quelques heures à installer et comprendre l'environnement d'exécution (compilateur/interpréteur) et quelques autres heures à connaitre les bases du langage (comment déclarer une fonction, par où commence l’exécution de l'application).</p><p>Or connaitre un langage, ce n'est pas que ça, c'est aussi connaitre toutes les API/fonctions embarquées/subtilités qui sont inclues dedans.</p><p>Prenons l'exemple de l'<code>Array</code>. La plupart des développeurs, quand ils voudront faire une opération sur un tableau, vont passer par une boucle for. Alors qu'une très grande partie des traitements que l'on pourrait vouloir faire sur un tableau sont déjà pensées et implémentées dans Javascript.</p><p>Voici une fonction (naive) qui indique si un élément est dans un tableau :</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">hasValue</span> <span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br>        length <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lenght<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token function">hasValue</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> true</span><br><span class="token function">hasValue</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> false</span></code></pre><p>Et sa version simplifiée :</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">hasValue</span> <span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token function">hasValue</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> true</span><br><span class="token function">hasValue</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> false</span></code></pre><p>De façon générale, je vous suggère d'aller systématiquement faire un tour sur les documentations des API que vous utilisées pour en connaitre toutes les possibilités. (Pour Javascript, la documentation w3schools.com est très bien faite et simple d'accès et pour vraiment tout savoir sur Javascript, il n'y a qu'une adresse : developer.mozilla.org).</p><h2 id="tl%3Bdr%3B">tl;dr;</h2><p>En bref les quelques bonne habitudes à prendre quand vous développez en Javascript :</p><ul><li>utiliser le mode strict (<code>'use strict'</code>) ;</li><li>ne mettre que l’essentiel dans l'objet window ;</li><li>injecter sois même les objets dont le code a besoin ;</li><li>utiliser le langage dans son intégralité.</li></ul><p>Ensuite il ne vous reste plus qu'a coder ;)</p></div><br><em>You enjoyed this article? Consider <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/tweet?url=https://blog.atomrc.dev/p/optimiser-son-code-javascript/&text=Soigner son code Javascript&via=atomrc">tweeting it</a> :)</em></article><script src="/js/application.js" async></script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "https://blog.atomrc.dev#website",
      "url": "https://blog.atomrc.dev",
      "name": "Thomas Belin",
      "description": "Senior Front-End Architect @deezer in Paris. I leave code cleaner than I found it. Seriously into Functional and Reactive Programming.",
      "inLanguage": "fr"
    },
    {
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.atomrc.dev/p/optimiser-son-code-javascript/"
      },
      "url": "https://blog.atomrc.dev/p/optimiser-son-code-javascript/",
      "isPartOf": {
        "@id": "https://blog.atomrc.dev#website"
      },
      "headline": "Soigner son code Javascript",
      "description": "Javascript a été prévu pour être un langage très simple d'accès au détriment de ses performances. C'est donc a vous de faire quelques efforts pour avoir un code optimisé",
      "image": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
      "inLanguage": "fr",
      "publisher": {
        "@type": "Organization",
        "name": "Thomas Belin",
        "url": "https://blog.atomrc.dev",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
          "width": 300,
          "height": 300
        }
      },
      "author": {
        "@type": "Person",
        "name": "Thomas Belin"
      },
      "keywords": "posts,JavaScript,Code,Bonnes Pratiques",
      "datePublished": "2013-08-24T00:00:00.000Z"
    }
  ]
}</script></section><div id="footer"><address>Senior Front-End Engineer <a href="https://deezer.com" target="_blank" rel="noreferrer noopener">@deezer</a> in Paris.<br>I leave code cleaner than I found it.<br>I give talks (<a href="/talks/">my talks</a>)<br>I tweet (<a href="https://twitter.com/atomrc" target="_blank" rel="noreferrer noopener">@atomrc</a>) and I code (<a href="https://github.com/atomrc" target="_blank" rel="noreferrer noopener">atomrc</a>)<br>I help (<a href="https://stackoverflow.com/users/2745879/atomrc" target="_blank" rel="noreferrer noopener">S.O profile</a>)</address></div></body></html>