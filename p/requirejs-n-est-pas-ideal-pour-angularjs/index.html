<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="alternate" type="application/rss+xml" title="Thomas Belin's Blog" href="https://blog.atomrc.dev/feed.xml"><link rel="icon" href="/favicon.ico"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><title>RequireJS n'est pas idéal pour AngularJS - Thomas Belin</title><meta name="description" content="Utiliser RequireJS plus intelligemment afin de ne pas brider AngularJS"><meta name="author" content="Thomas Belin"><link rel="canonical" href="https://blog.atomrc.dev/p/requirejs-n-est-pas-ideal-pour-angularjs/"><meta name="color-scheme" content="dark light"><style>body{--ff-sans:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Ubuntu","Roboto","Noto Sans","Droid Sans",sans-serif;--ff-mono:ui-monospace,"Cascadia Mono","Segoe UI Mono","Ubuntu Mono","Roboto Mono",Menlo,Monaco,Consolas,monospace;padding:0;margin:0;color:var(--font-color);background-color:var(--bg-color);font-family:var(--ff-sans);font-size:13pt}body,body.light-mode{--font-color:#333;--font-secondary-color:#555;--bg-color:#fff;--title-color:#e7005d;--link-color:#0e4db5;--bg-code-color:#f6f6f6;--secondary-color:#eee}body.dark-mode{--font-color:#ddd;--font-secondary-color:#aaa;--bg-color:#1c1c21;--title-color:var(--link-color);--link-color:rgb(88, 166, 255);--bg-code-color:#444;--secondary-color:#333}#dark-mode-toggle{border:none;background-color:transparent;position:fixed;top:1em;right:1em;z-index:1;height:24px;width:24px;overflow:hidden}#dark-mode-toggle svg{stroke:var(--font-color);fill:var(--font-color);transition:opacity .3s,fill .3s,stroke .3s;position:absolute;top:0;left:0}.dark-mode #dark-mode-toggle .moon,.light-mode #dark-mode-toggle .sun{opacity:0}a{text-decoration:none;color:var(--link-color)}ul{list-style:none;padding:0}.avatar{height:100px;width:100px;border-radius:50px}.title{color:var(--title-color)}.tag{font-size:10pt;color:var(--font-secondary-color);font-style:italic}#header{text-align:center;font-size:1.95em;padding:1em}#header .title{color:var(--font-color);font-weight:200}#footer{text-align:center;padding:2em}.love{color:red}#footer a{color:inherit;text-decoration:underline}</style><script async defer="defer" data-domain="atomrc.dev" src="https://plausible.io/js/plausible.js"></script></head><body><button id="dark-mode-toggle" aria-label="Toggle bewteen dark and light mode"><svg xmlns="http://www.w3.org/2000/svg" class="sun" stroke-linejoin="round" stroke-linecap="round" stroke-width="2" stroke="#000" fill="none" height="24" width="24"><circle r="5" cy="12" cx="12"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72 1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" class="moon"><path style="stroke-width:.0469517" d="M13.278 24.02c3.707 0 7.093-1.687 9.336-4.451a.564.564 0 0 0-.543-.909c-5.831 1.111-11.186-3.36-11.186-9.247a9.41 9.41 0 0 1 4.765-8.188.564.564 0 0 0-.176-1.044 12.12 12.12 0 0 0-2.196-.2C6.643-.02 1.258 5.356 1.258 12c0 6.635 5.376 12.02 12.02 12.02z"/></svg></button><script>(function (win, doc) {
  let isDarkMode =
    sessionStorage.getItem("darkmode") === undefined
      ? win.matchMedia("(prefers-color-scheme: dark)").matches
      : sessionStorage.getItem("darkmode") === "true";

  const toggleDarkMode = (setDarkMode) => {
    isDarkMode = setDarkMode ?? !isDarkMode;
    sessionStorage.setItem("darkmode", isDarkMode);
    if (isDarkMode) {
      document.body.classList.add("dark-mode");
      document.body.classList.remove("light-mode");
    } else {
      document.body.classList.remove("dark-mode");
      document.body.classList.add("light-mode");
    }
  };

  toggleDarkMode(isDarkMode);
  const darkModeToggle = doc.getElementById("dark-mode-toggle");

  darkModeToggle.addEventListener("click", () => toggleDarkMode());
})(window, document);</script><div id="header"><div><a href="/"><img class="avatar" src="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=200" alt="Avatar"></a><br><a class="title" href="/"><span rel="author">Thomas Belin</span></a><br></div></div><section><link href="/css/article.css" rel="stylesheet" async defer="defer"><link href="/css/syntax.css" rel="stylesheet" async defer="defer"><style>article{max-width:800px;margin:auto;padding:0 1em;position:relative;line-height:1.5em}article h1{font-size:2em;font-weight:300;line-height:1.2em}article h2,article h3{position:relative;padding-bottom:.3em;font-weight:500;line-height:1.2em}article h2{font-size:2em;border-bottom:solid 1px var(--secondary-color);margin:1em 0 .5em}article h3{font-size:1.5em;margin:1em 2em}article ul{list-style-type:disc;padding:0 2em}article img{border:solid 1px grey;display:block;max-width:90%;margin:auto}</style><article lang="fr"><header><h1 class="title">RequireJS n'est pas idéal pour AngularJS</h1><aside><time class="folded-paper" datetime="2013-04-14T00:00:00.000Z" pubdate itemprop="datePublished" content="2013-04-14T00:00:00.000Z">14 <span class="month">Apr</span> 2013</time><br><span class="tag">posts</span>&nbsp; <span class="tag">javascript</span>&nbsp; <span class="tag">angularjs</span>&nbsp; <span class="tag">requirejs</span>&nbsp; <span class="tag">amd</span>&nbsp;</aside></header><div class="article-body"><p>Il n'y a pas longtemps, je publiais un article sur la combinaison d'<a href="/p/combiner-angularjs-et-requirejs/">AngularJS avec RequireJS</a>. Depuis, mon blog a connu un certain nombre d'évolutions et tout particulièrement une qui m'a fait revenir sur l'utilisation de RequireJS avec Angular. C'est le passage à des urls HTML5 et la façon dont je chargeais les pages qui m'ont fait voir le problème.</p><h2 id="ne-pas-rater-le-bootstrap-d'angular" tabindex="-1">Ne pas rater le bootstrap d'Angular</h2><p>Si vous êtes venu sur mon blog entre fin mars et mi avril, vous avez peut-être constaté qu'au premier chargement, la page clignotait une fois. Vous voyiez le contenu une première fois puis il disparaissait pour ré-apparaitre en fondu. La raison de ce scintillement était double : mon serveur envoyait une page complète (non plus une page vide qu'Angular allait remplir) et Angular ne se chargeait qu'après l'affichage de cette page. Pour palier à ce scintillement, je n'avais qu'une seule possibilité : il fallait qu'Angular soit chargé avant le DOM. De cette façon, Angular allait pouvoir cacher les éléments qu'il allait remplir par la suite avec les données brutes du serveur.</p><h2 id="pas-de-chargement-synchrone-avec-requirejs" tabindex="-1">Pas de chargement synchrone avec RequireJS</h2><p>Après avoir analyser que le problème de scintillement venais du chargement asynchrone d'AngularJS, je me suis dis qu'il devait y avoir un moyen de dire à RequireJS de charger certains scripts de façon synchrone. J'ai donc commencé par regarder les forums puis, ne trouvant rien de bien concret sur le sujet, je allé mettre mon nez dans les sources de RequireJS. Malheureusement, je suis tombé sur <a href="https://github.com/jrburke/requirejs/blob/2.1.11/require.js#L1821">cette ligne</a> qui a mis fin à tous mes espoirs. C'est le seul endroit du code qui créé une balise script et comme vous pouvez le voir, le paramètre node.async est forcé à true. Aucun moyen donc d'influer sur ce paramètre. Je n'avais donc pas le choix, j'allais devoir ne pas charger AngularJS avec RequireJS</p><h2 id="vers-une-utilisation-plus-intelligente-de-requirejs" tabindex="-1">Vers une utilisation plus intelligente de RequireJS</h2><p>Attention, ici, il n'est pas question de se débarrasser complètement de RequireJS, mais simplement de ne pas l'utiliser pour tout le code dont je vais avoir besoin dès le chargement de la page. Je vais donc passer d'un head HTML comme ça :</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/js/lib/require.min.js<span class="token punctuation">"</span></span> <span class="token attr-name">data-main</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>js/src/main.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></code></pre><p>à un code de ce style :</p><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>head<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> chargement des libraries nécessaires au chargement <span class="token operator">--</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"/js/lib/require.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br>  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"/js/lib/angular.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br>  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"/js/lib/angular.resource.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br>  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"/js/lib/angular.sanitize.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br><br>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> chargement du code de l'application  <span class="token operator">--</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"/js/src/application.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span></code></pre><p>De cette façon, quand la page est envoyée au navigateur, celui-ci va d'abord charger les fichiers Javascript indiqués avant de commencer le traitement du DOM. Angular sera donc présent lorsque le navigateur commencera cette opération. Bon je sais, si vous avez lu <a href="/p/combiner-angularjs-et-requirejs/">mon article sur AngularJS et RequireJS</a>, vous pourrez dire que j'ai perdu :(.</p><p>Comme je vous l'ai dit il n'est pas question d'abandonner totalement RequireJS et vous avez pu le voir dans ma nouvelle balise head qu'il est encore chargé sur mon blog. Pour tout vous dire je m'en sert pour charger d'autres bibliothèques externes (RainbowJS pour la coloration syntaxique par exemple), pour les boutons de réseaux sociaux et pour la compilation.</p><h2 id="conclusion" tabindex="-1">Conclusion</h2><p>Après mon retour sur les urls hashbang, voila que je reviens sur la combinaison de RequireJS et AngularJS. Mais ces erreurs sont avant tout à prendre comme une source d'apprentissage et, pour ça, je suis très content d'avoir fait ces erreurs. Alors que je pensais que RequireJS, et plus généralement l'AMD, pouvait se poser comme une sorte de standard de développement pour une application JS, je me suis rendu compte que ce n'est qu'un autre outil parfait pour certains besoin mais clairement inadapté pour d'autres. J'avais eu l'occassion de discuter avec <a href="https://twitter.com/maxdow">@maxdow</a> de l'utilité de mettre en place RequireJS avec AngularJS (en rapport avec son article <a href="http://maxlab.fr/blog/2013/03/angularjs-requirejs-seed/">AngularJs – RequireJs seed</a>). Alors qu'il se posait des questions sur cette association, je la trouvait parfaite. Seulement, à ce moment là, je n'avais pas encore identifié de problème avec. Maintenant si ...</p></div><br><em>You enjoyed this article? Consider <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/tweet?url=https://blog.atomrc.dev/p/requirejs-n-est-pas-ideal-pour-angularjs/&text=RequireJS n'est pas idéal pour AngularJS&via=atomrc">tweeting it</a> :)</em></article><script src="/js/posts.js" async></script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "https://blog.atomrc.dev#website",
      "url": "https://blog.atomrc.dev",
      "name": "Thomas Belin",
      "description": "Freelance Front-End Architect in Paris. I leave code cleaner than I found it. Seriously into Functional and Reactive Programming.",
      "inLanguage": "fr"
    },
    {
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.atomrc.dev/p/requirejs-n-est-pas-ideal-pour-angularjs/"
      },
      "url": "https://blog.atomrc.dev/p/requirejs-n-est-pas-ideal-pour-angularjs/",
      "isPartOf": {
        "@id": "https://blog.atomrc.dev#website"
      },
      "headline": "RequireJS n'est pas idéal pour AngularJS",
      "description": "Utiliser RequireJS plus intelligemment afin de ne pas brider AngularJS",
      "image": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
      "inLanguage": "fr",
      "publisher": {
        "@type": "Organization",
        "name": "Thomas Belin",
        "url": "https://blog.atomrc.dev#organization",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
          "width": 300,
          "height": 300
        }
      },
      "author": {
        "@type": "Person",
        "name": "Thomas Belin"
      },
      "keywords": "posts,javascript,angularjs,requirejs,amd",
      "datePublished": "2013-04-14T00:00:00.000Z"
    }
  ]
}</script></section><div id="footer">Made with <span class="love">♥</span>️ by <a href="https://twitter.com/atomrc" rel="noopener noreferrer">@atomrc</a></div></body></html>