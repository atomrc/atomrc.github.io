<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="alternate" type="application/rss+xml" title="Thomas Belin's Blog" href="https://blog.atomrc.dev/feed.xml"><link rel="icon" href="/favicon.ico"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><title>Passer des urls hashbang (#!) au HTML5 pushState - Thomas Belin</title><meta name="description" content="Apr√®s avoir fait tout mon blog avec des urls hashbang, pourquoi et comment je suis pass√© √† des urls HTML5."><meta name="author" content="Thomas Belin"><link rel="canonical" href="https://blog.atomrc.dev/p/passer-des-urls-hashbang-au-html5-pushstate/"><meta property="og:title" content="Passer des urls hashbang (#!) au HTML5 pushState - Thomas Belin"><meta property="og:description" content="Apr√®s avoir fait tout mon blog avec des urls hashbang, pourquoi et comment je suis pass√© √† des urls HTML5."><meta property="og:url" content="https://blog.atomrc.dev/p/passer-des-urls-hashbang-au-html5-pushstate/"><meta property="og:image" content="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@atomrc"><meta name="twitter:title" content="Passer des urls hashbang (#!) au HTML5 pushState - Thomas Belin"><meta name="twitter:description" content="Apr√®s avoir fait tout mon blog avec des urls hashbang, pourquoi et comment je suis pass√© √† des urls HTML5."><meta name="twitter:image" content="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc"><meta name="color-scheme" content="dark light"><style>body{--ff-sans:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Ubuntu","Roboto","Noto Sans","Droid Sans",sans-serif;--ff-mono:ui-monospace,"Cascadia Mono","Segoe UI Mono","Ubuntu Mono","Roboto Mono",Menlo,Monaco,Consolas,monospace;padding:0;margin:0;color:var(--font-color);background-color:var(--bg-color);font-family:var(--ff-sans);font-size:13pt}body,body.light-mode{--font-color:#333;--font-secondary-color:#555;--bg-color:#fff;--title-color:#e7005d;--link-color:#0e4db5;--bg-code-color:#f6f6f6;--secondary-color:#eee}body.dark-mode{--font-color:#ddd;--font-secondary-color:#aaa;--bg-color:#1c1c21;--title-color:var(--link-color);--link-color:rgb(88, 166, 255);--bg-code-color:#444;--secondary-color:#333}#dark-mode-toggle{border:none;background-color:transparent;position:fixed;top:1em;right:1em;z-index:1;height:24px;width:24px;overflow:hidden}#dark-mode-toggle svg{stroke:var(--font-color);fill:var(--font-color);transition:opacity .3s,fill .3s,stroke .3s;position:absolute;top:0;left:0}.dark-mode #dark-mode-toggle .moon,.light-mode #dark-mode-toggle .sun{opacity:0}a{text-decoration:none;color:var(--link-color)}ul{list-style:none;padding:0}.avatar{height:100px;width:100px;border-radius:50px}.title{color:var(--title-color)}.title a{color:inherit}.list-title{font-size:1.2em;font-weight:400;margin:.1em}aside{font-size:.8em}#header{text-align:center;font-size:1.95em;padding:1em}#header nav{text-align:center;margin-top:.6em;font-size:.5em}#header .title{color:var(--font-color);font-weight:200}footer{text-align:center;padding:2em}.love{color:red}footer a{color:inherit;text-decoration:underline}.list-container{max-width:50%;margin:auto;text-align:center}@media screen and (max-width:1000px){.list-container{max-width:75%}}@media screen and (max-width:650px){.list-container{max-width:80%}}.list-container__title{text-align:center}.list-container__list li{padding-bottom:.5em}.list-container__headline{max-width:500px}.list-container__content{display:inline-block;text-align:left}</style><script async defer="defer" data-domain="atomrc.dev" src="https://plausible.io/js/plausible.js"></script></head><body><button id="dark-mode-toggle" aria-label="Toggle bewteen dark and light mode"><svg xmlns="http://www.w3.org/2000/svg" class="sun" stroke-linejoin="round" stroke-linecap="round" stroke-width="2" stroke="#000" fill="none" height="24" width="24"><circle r="5" cy="12" cx="12"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72 1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" class="moon"><path style="stroke-width:.0469517" d="M13.278 24.02c3.707 0 7.093-1.687 9.336-4.451a.564.564 0 0 0-.543-.909c-5.831 1.111-11.186-3.36-11.186-9.247a9.41 9.41 0 0 1 4.765-8.188.564.564 0 0 0-.176-1.044 12.12 12.12 0 0 0-2.196-.2C6.643-.02 1.258 5.356 1.258 12c0 6.635 5.376 12.02 12.02 12.02z"/></svg></button><script>(function (win, doc) {
  let isDarkMode =
    sessionStorage.getItem("darkmode") === undefined
      ? win.matchMedia("(prefers-color-scheme: dark)").matches
      : sessionStorage.getItem("darkmode") === "true";

  const toggleDarkMode = (setDarkMode) => {
    isDarkMode = setDarkMode ?? !isDarkMode;
    sessionStorage.setItem("darkmode", isDarkMode);
    if (isDarkMode) {
      document.body.classList.add("dark-mode");
      document.body.classList.remove("light-mode");
    } else {
      document.body.classList.remove("dark-mode");
      document.body.classList.add("light-mode");
    }
  };

  toggleDarkMode(isDarkMode);
  const darkModeToggle = doc.getElementById("dark-mode-toggle");

  darkModeToggle.addEventListener("click", () => toggleDarkMode());
})(window, document);</script><section id="header"><div><a href="/"><img class="avatar" src="https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=200" alt="Avatar"></a><br><a class="title" href="/"><span rel="author">Thomas Belin</span></a><br></div><nav><a href="/about/">About Me</a></nav></section><section><link href="/css/article.css" rel="stylesheet" async defer="defer"><link href="/css/syntax.css" rel="stylesheet" async defer="defer"><style>article{max-width:800px;margin:auto;padding:0 1em;position:relative;line-height:1.5em}article h1{font-size:2em;font-weight:300;line-height:1em}article h2,article h3{position:relative;padding-bottom:.3em;font-weight:500;line-height:1.2em}article h2{font-size:2em;border-bottom:solid 1px var(--secondary-color);margin:1em 0 .5em}article h3{font-size:1.5em;margin:1em 1em}article ul{list-style-type:disc;padding:0 2em}article picture{border:solid 1px grey;display:block;max-width:100%;margin:auto}picture img,video{width:100%;height:auto}</style><article lang="fr"><header><h1 class="title">Passer des urls hashbang (#!) au HTML5 pushState</h1><aside>üè∑Ô∏è <span class="tag">posts</span>&nbsp; <span class="tag">seo</span>&nbsp; <span class="tag">ajax</span>&nbsp;<br><time datetime="2013-05-30T00:00:00.000Z" pubdate itemprop="datePublished" content="2013-05-30T00:00:00.000Z">üìÜ 30&nbsp;May&nbsp;13</time></aside></header><div class="article-body"><p>Mon dernier article sur le <a href="/p/le-referencement-d-une-application-ajax/">r√©f√©rencement d'une application Ajax</a> s'appuyait enti√®rement sur les recommandations de Google pour l'indexation d'une application Javascript et notamment le hack du hashbang. Seulement, peu de temps apr√®s avoir √©crit cet article, je me suis rendu compte que le hasbang n'√©tait pas optimal du tout et entra√Ænait bon nombre de complications (boutons de r√©seaux sociaux, r√©f√©rencement, lisibilit√© du code serveur ...). Je vais donc vous pr√©senter ici les raisons pour lesquelles j'ai d√©cid√© de revoir compl√©tement mes urls et surtout tout ce que cela implique.</p><h2 id="les-%23%25!%C2%B0%24%2B!!-de-probl%C3%A8mes-avec-le-%23!" tabindex="-1">les #%!¬∞$+!! de probl√®mes avec le <code>#!</code></h2><p>La premi√®re chose qu'il faut bien comprendre c'est que le hashbang est un affreux hack pour faire croire, d'une part, √† votre navigateur qu'il n'a pas chang√© de page et d'autre part pour faire savoir aux moteurs de recherche que votre application est Ajax. Or, par d√©finition, un hack n'est pas franchement quelque chose de propre. Et en l'occurrence dans notre cas, notre hack va avec son lot de probl√®mes.</p><h3 id="les-boutons-de-r%C3%A9seaux-sociaux" tabindex="-1">Les boutons de r√©seaux sociaux</h3><p>ce sont les premiers √† m'avoir fait r√©fl√©chir au passage vers des urls HTML5. Si jusque l√† j'avais beaucoup de plaisir √† explorer le terrain des urls hashbang, j'ai beaucoup d√©chant√© lorsqu'il a s'agit de passer √† l'int√©gration des boutons de partage. J'avais commenc√© avec Twitter puis Google+ et ce dernier m'a fait compl√®tement abandonner les <code>#!</code>.</p><h3 id="twitter" tabindex="-1">Twitter</h3><p>Tout semblait bien se passer, les tweets se passaient tr√®s bien et les liens vers mon blog marchaient sans probl√®me, seulement le compteur de tweets affichait n'importe quoi (de temps en temps 0, de temps en temps le nombre de liens pointant sur la racine du site). Visiblement pas mal de monde a eu ce probl√®me, en t√©moignent les posts sur le forum de Twitter ici, l√† ou encore ici. Et malheureusement pas de r√©ponse claire sur la solution √† adopter ... Personnellement j'ai essay√© avec les urls contenant le <code>#!</code> et les urls avec le <code>_escaped_fragment_</code>, rien n'a march√© correctement.</p><h3 id="google%2B" tabindex="-1">Google+</h3><p>Si le compte des tweets √©tait un peu g√©nant, avec Google+ c'√©tait carr√©ment la cata puisque je ne pouvais m√™me pas partager mon article. Lorsque je cliquais sur le bouton, celui-ci se transformait en <img src="//i.imgur.com/EWN9CTU.png" alt="Google plus of death"> et j'avais le droit √† un beau code d'erreur -32099. Pareil que pour Twitter, j'ai essay√© avec les urls <code>#!</code> et <code>_escaped_fragment_</code>, mais rien √† y faire, √ßa ne marchait pas ! Contrairement √† Twitter, je n'ai pas trouv√© de commentaire d'utilisateur essayant de mettre un bouton Google+ sur un site Ajax. Il y a bien des choses sur l'erreur -32099 mais en r√©alit√© √ßa n'aide pas beaucoup puisque √ßa dit juste qu'il y a une erreur sur le serveur...</p><h3 id="le-r%C3%A9f%C3%A9rencement" tabindex="-1">Le r√©f√©rencement</h3><p>Il faut bien l'avouer, le r√©f√©rencement avec des <code>#!</code>, ce n'est pas de tout repos. Vous avez constamment un code sp√©cifique aux moteurs de recherche qui tourne sur votre serveur et il est tr√®s fastidieux de tester ce que le robot voit en r√©alit√© (vous √™tes oblig√© de tester les urls une √† une en rempla√ßant le <code>#!</code> et en d√©sactivant Javascript). Je ne m'en rendais pas compte avant, mais en passant √† des urls classiques, je remarque que beaucoup de choses se comportent mieux sur l'interface de Google Webmaster. Par exemple, lorsque j'utilisais la fonction &quot;Explorer comme Google&quot; et que je faisais un demande d'ajout des urls test√©s dans l'index l'√©tat de l'url mettait un temps fou √† passer √† l'√©tat &quot;URL envoy√©e pour indexation&quot;. D√®s que je suis pass√© √† des urls classiques cet √©tat se met √† jour instantan√©ment !</p><h3 id="toutes-les-petites-choses-%3A" tabindex="-1">Toutes les petites choses :</h3><ul><li>vos urls ne sont pas tr√®s jolies ;</li><li>il n'est pas facile de d√©tecter quand le code serveur pour les robots est cass√© ;</li><li>votre conscience de bon d√©veloppeur vous dit que c'est mal d'utiliser un hack.</li></ul><h2 id="le-passage-vers-les-urls-html5" tabindex="-1">Le passage vers les urls HTML5</h2><p>HTML5 vient avec une quantit√© ph√©nom√©nale de fonctionnalit√©s et parmi elles se cache le History API. Et il se trouve qu'il est l√† pr√©cis√©ment pour faire ce que l'on cherche √† faire ici : faire une application Ajax avec des urls pour chaque √©tat ! En m'y mettant, j'avais peur que cela implique beaucoup de changements, mais au final tout s'est pass√© tr√®s bien et tr√®s rapidement.</p><p>Bonne nouvelle par rapport √† mon <a href="/p/le-referencement-d-une-application-ajax/">pr√©c√©dent article sur le r√©f√©rencement</a>, nous allons pouvoir utiliser exactement le m√™me code pour les visiteurs que pour les moteurs de recherche. Plus besoin de faire la distinction. De toute fa√ßon vous n'avez plus de moyen fiable pour la faire (du moins plus avec les urls). Deuxi√®me bonne nouvelle, vous allez d√©sormais √™tre <strong>compatible avec les visiteurs sans Javascript</strong>.</p><p>L'id√©e est donc de renvoyer, dans tous les cas, le snapshot d'un √©tat de l'application en fonction de l'url demand√©. Ensuite les visiteurs qui ont Javascript navigueront en Ajax sur l'application alors que les visiteurs sans Javascript et les moteurs de recherches ne navigueront qu'au travers des snaphots de l'application.</p><p>Pour ce qui est de la g√©n√©ration des snapshots je vous laisse consulter mon <a href="/p/le-referencement-d-une-application-ajax/">article sur le r√©f√©rencement</a>.</p><h2 id="et-voila" tabindex="-1">Et voila</h2><p>Les changements techniques pour passer d'une application en urls hashbang √† des urls HTML5 sont relativement minimes. Cependant, r√©alisez bien que en dehors des petits changement dans le code, vous aurez un gros travail √† faire aupr√®s des services li√©s √† votre application. Si cela peut vous aider, voila un petit pense b√™te des choses que j'ai d√ª changer pour mon blog suite au changement d'urls :</p><ul><li>supprimer toutes les urls <code>#!</code> de Google Webmaster ;</li><li>faire la migrations des commentaires Disqus ;</li><li>mettre √† jour les liens internes dans les articles ;</li><li>mettre √† jour les liens post√©s sur les r√©seaux sociaux.</li></ul><p>Et bien sur cette liste s'alonge plus vous utilisez de services diff√©rents et devient quasiment ing√©rable si vous attendez trop longtemps avant de faire ce changement d'urls.</p><h2 id="conclusion" tabindex="-1">Conclusion</h2><p>Lorsque j'ai fais mon blog, je connaissais l'existence de l'<a href="https://developer.mozilla.org/en-US/docs/DOM/Manipulating_the_browser_history">History API</a> mais je voulais vraiment explorer la piste des urls hashbang. Seulement si cette technique est tr√®s bien pour le r√©f√©rencement Google (et probablement d'autre) elle l'est beaucoup moins pour tous les r√©seaux. Mon seul regret dans cette histoire est de ne pas avoir compris pourquoi mes boutons Twitter et Google+ ne marchaient pas. J'ai tourn√© le probl√®me dans beaucoup de sens (surement pas tous) sans que cela n'ai chang√© quoi que ce soit. Ce qui me navre le plus c'est de n'avoir aucune r√©ponse √† donner sur cette question. Je ne comprends pas bien comment Google, qui respecte pourtant le hashbang pour le r√©f√©rencement, ne le supporte pas pour son r√©seau social ... Il est bien s√ªr possible que mon probl√®me vienne de mon impl√©mentation du hashbang, cependant, depuis que je suis pass√© aux urls HTML5 tout fonctionne sans aucun probl√®me :)</p></div><br><em>You enjoyed this article? Consider <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/tweet?url=https://blog.atomrc.dev/p/passer-des-urls-hashbang-au-html5-pushstate/&text=Passer des urls hashbang (#!) au HTML5 pushState&via=atomrc">tweeting it</a> :)</em></article><script src="/js/posts.js" async></script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "https://blog.atomrc.dev#website",
      "url": "https://blog.atomrc.dev",
      "name": "Thomas Belin",
      "description": "Freelance Front-End Architect in Paris. I leave code cleaner than I found it. Seriously into Functional and Reactive Programming.",
      "inLanguage": "fr"
    },
    {
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.atomrc.dev/p/passer-des-urls-hashbang-au-html5-pushstate/"
      },
      "url": "https://blog.atomrc.dev/p/passer-des-urls-hashbang-au-html5-pushstate/",
      "isPartOf": {
        "@id": "https://blog.atomrc.dev#website"
      },
      "headline": "Passer des urls hashbang (#!) au HTML5 pushState",
      "description": "Apr√®s avoir fait tout mon blog avec des urls hashbang, pourquoi et comment je suis pass√© √† des urls HTML5.",
      "image": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
      "inLanguage": "fr",
      "publisher": {
        "@type": "Organization",
        "name": "Thomas Belin",
        "url": "https://blog.atomrc.dev#organization",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=300",
          "width": 300,
          "height": 300
        }
      },
      "author": {
        "@type": "Person",
        "name": "Thomas Belin"
      },
      "keywords": "posts,seo,ajax",
      "datePublished": "2013-05-30T00:00:00.000Z"
    }
  ]
}</script></section><footer>Made with <span class="love">‚ô•</span>Ô∏è by <a href="https://twitter.com/atomrc" rel="noopener noreferrer">@atomrc</a><br><a href="/feed.xml">RSS feed</a></footer></body></html>