---
title: "UI as Pure Functions of Time"
description: "What if we considered Time as a fundamental input of our applications?"
categories: [javascript, reactive, cyclejs]
lang: fr
extra: "CycleConf 2017"
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>UI as Pure Functions of Time</title>
    <meta name="robots" content="noindex">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      @import url(https://fonts.googleapis.com/css?family=Open+Sans:400);
      @import url(https://fonts.googleapis.com/css?family=Montserrat:400);

      body {
        font-family: Open Sans, Arial, sans serif;
        color: #fff;
      }

      .remark-slide-content:not(.naked)::after {
          content: "@atomrc | CycleConf 2017";
          position: absolute;
          bottom: 0;
          left: 0;
          padding: 1em;
          font-size: 1em;
      }

      img {
        max-width: 90%;
        max-height: 90%;
      }

      .remark-slide-content {
        /*background: white;*/
        background-color: #057FFA;
        padding: 0 3em;
      }
      .remark-container {
        background-color: #EEE;
      }
      .remark-code {
        padding: 0 10em;
      }
      .remark-slide-scaler {
        box-shadow: none;
      }

      .center {
        text-align: center;
      }
      .left-align h2 {
        text-align: left;
      }

      h1, h2, h3 {
        margin: 1em;
        margin-bottom: 1em;
        text-align: center;
        font-weight: lighter;
        font-family: Montserrat;
      }

      .semi-condensed h1 {
          margin: 0.5em;
      }
      .condensed h1 {
          margin: 0.3em;
      }

      a { color: inherit; }

      svg {
        max-width: 90%;
        max-height: 520px;
      }

      li {
        padding: 0.5em;
      }

      .naked .foot, .naked .remark-slide-number {
        display: none;
      }

      .foot {
        position: absolute;
        bottom: 1em;
        left: 1em;
      }

      .remark-inline-code {
        background-color: #03002E;
        color: white;
        padding: 2px;
        border-radius: 0.2em;
      }
      .centered-code pre{
        flex: 1;
        margin: auto;
      }
      .centered-code code.hljs {
        padding: 3em;
      }

      .box {
        margin: auto;
        color: white;
        background-color: #3e3e3e;
        border-radius: 5px;
        padding: 0.5em;
      }

      .animate-from-bottom {
        position: absolute;
        top: 0;
        left: 0;
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
        transform: translateY(100%);
        transition: transform 1s;
      }
      .middled {
        margin: auto;
      }
      .banner {
        font-size: 2.5em;
        border-radius: 5px;
        background-color: #EEE;
        color: #555;
        font-weight: bold;
        padding: 1em;
        box-shadow: 5px 5px 10px #666;
      }
      .entered .animate-from-bottom {
        transform: translateY(0);
      }

      img[alt="thomas belin"] {
        border-radius: 100px;
        border: solid 5px white;
      }
      blockquote {
        text-align: center;
        background: white;
        color: #444;
        border-radius: 5px;
        padding: 0.5em 1em;
        font-size: 2em;
        position: relative;
        border: 1px solid #CCC;
      }
      blockquote::before, blockquote::after {
        position: absolute;
        content: "✶";
      }
      blockquote::before {
        top: 0.25em;
        left: 0.25em;
      }
      blockquote::after {
        bottom: 0.25em;
        right: 0.25em;
      }

      .hljs-github .hljs-comment {
          color: #0040f8;
      }
      .highlighted .remark-code-line:not(.remark-code-line-highlighted) {
        opacity: 0.4;
      }
      .remark-code-line-highlighted {
        background-color: inherit;
        font-weight: bold;
      }

      .big-code .remark-code {
        font-size: 1.5em;
      }
      .huge-code .remark-code {
        font-size: 2em;
      }
      .check {
        font-size: 3em;
        color: lime;
      }

      #slide-intro svg {
        height: 200px;
      }

      #slide-cycle-intro svg {
        height: 200px;
      }

      #slide-intro svg .stream {
        stroke-width: 5 !important;
        stroke-linecap: round !important;
        stroke-dasharray: 0px, 15 !important;
      }

      svg .hidden {
        opacity: 0;
      }
      svg .appland {
        fill: none;
        stroke: #edaf1f;
        stroke-width: 5;
      }
      svg .stream {
        stroke-width: 10 !important;
        stroke-linecap: round !important;
        stroke-dasharray: 0px, 20 !important;
      }

      svg .stream.lf {
        stroke-dasharray: 0px, 40 !important;
      }

      svg .stream.vlf {
        stroke-dasharray: 0px, 80 !important;
      }

      .toggled svg .stream {
        display: none;
      }

      .hidden {
        opacity: 0;
      }

      #slide-test1 svg .stream {
        stroke-dasharray: 0px, 200 !important;
      }
      #slide-test2 svg .raf-stream {
        stroke-dasharray: 0px, 120px !important;
      }
      #slide-test2 svg .dom-stream {
        stroke-dasharray: 0px, 120px !important;
      }
      #slide-test2 svg .out-stream {
        stroke-dasharray: 0px, 120px !important;
      }

      #slide-pausev3 svg .raf-stream,
      #slide-pausev3 svg .out-stream {
        stroke-dasharray: 0px, 15px !important;
      }
      #slide-pausev3 svg .dom-stream {
        stroke-dasharray: 0px, 50px !important;
      }

      #slide-me {
          font-size: 2em;
      }

      #slide-medev #mozilla svg {
        height: 15em;
      }

      #slide-medev #poketom svg {
        height: 12em;
      }

      #slide-medev #poketom {
        transform: translateX(1500px);
        transition: all 2s;
      }
      .entered #slide-medev #poketom {
        transform: translateX(0);
      }

      #slide-medev #mozilla {
        transform: translateX(-1500px);
        transition: all 2s;
      }
      .toggled #slide-medev #mozilla {
        transform: translateX(0);
      }

      #mozescape svg {
        height: 5em;
        overflow: visible;
      }

    </style>
  </head>
  <body class="dark">
    <textarea id="source">
class: middle center naked
name: intro
# UI as Pure Functions of Time

{% include devoxx/darksideofthecycle.svg %}

#### CycleConf 2017 | @atomrc

---
class: middle naked
## « I wanna be a frontend developer! »
.right[— you, some time ago]

---
name: medev
class: middle naked
## « I wanna be a frontend developer! »
.right[— @atomrc, 2011]
<div id="poketom" class="poke" style="position: absolute; bottom: 1em; left: 1em">
{% include cycleconf/tom.svg %}
</div>
<div id="mozilla" class="poke" style="position: absolute; top: 1em; right: 1em">
{% include cycleconf/mozilla.svg %}
</div>

---
class: center
![html5 resume](https://cloud.githubusercontent.com/assets/1090716/21966622/0273c282-db77-11e6-886a-1ddee2ec3187.gif)

---
name: mozescape
class: naked center middle

<div id="mozescape">
{% include cycleconf/mozescape.svg %}
</div>

---
class: center
![html5 resume](https://cloud.githubusercontent.com/assets/1090716/21966622/0273c282-db77-11e6-886a-1ddee2ec3187.gif)

---
class: middle

# How would you read that code?

---
layout: true
# Anatomy of a `main.js`

---
```javascript
function main() {

  function run() {
    cvController.step();
    requestAnimationFrame(run);
  }

  requestAnimationFrame(run);
}
```

--
## I see many problems with that piece of code

---

.highlighted[
```javascript
function main() {

  function run() {
*   cvController.step();
*   requestAnimationFrame(run);
  }

* requestAnimationFrame(run);
}
```
]

## 3 instructions, 3 side effects!!

--
### But that's not really the subject here

---

.highlighted[
```javascript
function main() {

  function run() {
    cvController.step();
*   requestAnimationFrame(run); // ◀ Time is a dependency of our app
  }

* requestAnimationFrame(run);
}
```
]

---

.highlighted[
```javascript
*function main() {// ◀ why is it not an explicit parameter?

  function run() {
    cvController.step();
    requestAnimationFrame(run);
  }

  requestAnimationFrame(run);
}
```
]

---
layout: false
# You want more?

.hidden[
```javascript
var paused = false;
```
]

.hidden[
```javascript
document.addEventListener("keyup", function (ev) {
  if (ev.keyCode === 32) {
    paused = !paused;
  }
})
```
]

.highlighted[
```javascript
function run() {
  cvController.step();
* if (!paused) {
    requestAnimationFrame(run);
* }
}
```
]

---
# You want more?

```javascript
var paused = false;
```

.hidden[
```javascript
document.addEventListener("keyup", function (ev) {
  if (ev.keyCode === 32) {
    paused = !paused;
  }
})
```
]

.highlighted[
```javascript
function run() {
  cvController.step();
* if (!paused) {
    requestAnimationFrame(run);
* }
}
```
]

---
# You want more?

```javascript
var paused = false;
```

```javascript
document.addEventListener("keyup", function (ev) {
  if (ev.keyCode === 32) {
    paused = !paused;
  }
})
```

.highlighted[
```javascript
function run() {
  cvController.step();
* if (!paused) {
    requestAnimationFrame(run);
* }
}
```
]

---
class: middle
# Is VanillaJS the problem?

---
class: middle
# Let's try something else

---
# `main.ng.js`

```javascript
function main() {
  const app = angular.module("cv", ["cvModule"])

  app.run(function ($scope, cvController) {
    function update() {
      $scope.$apply(cvController.step.bind(cvController));
      raf(update)
    }
    raf(update)
  })

  angular.bootstrap(AppContainer, [app.name])
}
```

---
# `main.ng.js`

.highlighted[
```javascript
function main() {
  const app = angular.module("cv", ["cvModule"])

  app.run(function ($scope, cvController) {
    function update() {
      $scope.$apply(cvController.step.bind(cvController));
*     raf(update)
    }
*   raf(update)
  })

  angular.bootstrap(AppContainer, [app.name])
}
```
]

---
# `main.react.js`

```javascript
function main() {
  function run() {
    state = update(state)
    ReactDOM.render(
      <Cv data={state}/>,
      AppContainer
    )
    raf(run)
  }

  raf(run)
}
```

---
# `main.react.js`

.highlighted[
```javascript
function main() {
  function run() {
    state = update(state)
    ReactDOM.render(
      <Cv data={state}/>,
      AppContainer
    )
*   raf(run)
  }

* raf(run)
}
```
]


---
# `main.vue.js`

```javascript
function main() {
  const cv = new Vue({
    el: "#main",
    data: { state }
  })

  function run() {
    update(state)
    raf(run)
  }
  raf(run)
}
```

---
# `main.vue.js`

.highlighted[
```javascript
function main() {
  const cv = new Vue({
    el: "#main",
    data: { state }
  })

  function run() {
    update(state)
*   raf(run)
  }
* raf(run)
}
```
]

---
class: center
name: beforecycle
# Embed Time

<div>
  {% include devoxx/before-cycle.svg %}
</div>

---
name: cycle-intro
class: middle center
# And there is Cycle.js

{%include devoxx/cyclejs.svg %}

---
# `main.cycle.js`

```javascript
function main({ time }) {
  return {
    DOM: time
      .animationFrames()
      .fold(update, initialState)
      .map(render)
  }
}
```

---
# `main.cycle.js`

.highlighted[
```javascript
*function main({ time }) { // ◀ hello you
  return {
    DOM: time
      .animationFrames()
      .fold(update, initialState)
      .map(render)
  }
}
```
]

--
```javascript
run(main, {
  DOM: makeDOMDriver("#main"),
  time: timeDriver
})
```

---
class: center
name: aftercycle
# Injected Time

<div>
  {% include devoxx/after-cycle.svg %}
</div>

---
class: middle
# We are functions of Time

---
class: middle
# ... Why aren't our applications?

---
class: middle
# app = function (time) ?

---
class: middle
# What is a UI?

---
class: middle
> A function of the events it listens to

---
class: middle
# What is an event?

---
class: middle
> Something that happens at a very specific point in time

---
class: middle
> A function of Time

```javascript
function raf(timestamp) {
  return timestamp % 16 === 0;
}
```

---
class: left-align middle

--
## app = function (events)

--
## app = function (function (time))

--
## app = function (time)

--
### Thanks transitivity 👍 

---
class: middle

> events != signals

---
layout: false
class: middle
# Everything is a signal!

---
class: center big-code middle

```
raf ---x---x---x---x---x---x--->
```
--
```
geo ---48.8;2.2---48.8;2.3----->
```
--
```
server ----200-----404--------->
```
--
```
keyup ---------x---------x----->
```
--
```
click ----x----------x--------->
```

---
class: middle
# Instead of getting rid of Time...

---
class: middle
```javascript
input.addEventListener("keyup", function (event) {
  if (event.key === "Enter") {
    var name = event.target.value;
    user.name = name;
  }
})
```

---
class: middle
.highlighted[
```javascript
*input.addEventListener("keyup", function (event) { // Time-dependent
  if (event.key === "Enter") {
    var name = event.target.value;
    user.name = name;
  }
*})
```
]


---
class: middle
.highlighted[
```javascript
input.addEventListener("keyup", function (event) {
* if (event.key === "Enter") { // Space-dependent
*   var name = event.target.value;
*   user.name = name;
* }
})
```
]

---
class: middle

## ... Let's make everything time-dependent

---
class: middle

```javascript
const user$ = fromEvent("keyup", input)

  .filter(event => event.key === "Enter")

  .map(event => event.target.value)

  .fold((user, name) => ({ ...user, name }), {})
```

---
class: middle

# ... Let's make everything observable

---
class: middle

```javascript
const user$ = fromEvent("keyup", input)

  .filter(event => event.key === "Enter")        // observable

  .map(event => event.target.value)              // observable

  .fold((user, name) => ({ ...user, name }), {}) // observable
```

---
class: middle

# ... Let's make everything declarative

---
class:middle

```javascript
const user$ = fromEvent("keyup", input)

  .filter(isEnterKey)

  .map(getValue)

  .fold(userReducer, initialUser)
```

---
class: middle

# ... Let's make everything exportable

---
class: middle

```javascript
const keyup$ = fromEvent("keyup", input)

const enter$ = keyup$.filter(isEnterKey)

const name$ = enter$.map(getValue)

const user$ = name$.fold(userReducer, initialUser)
```

---
class: middle

# This is Reactive Programming

---
class: middle
# Thinking in DataFlow

--
### instead of instructions

---
class: middle
# Pause

---
class: middle
name: pausev1

<div style="float: right">
  {% include devoxx/pause-v1.svg %}
</div>

```javascript
function main({ time }) {

  const raf$ = time.animationFrames()

  return {
    DOM: raf$
      .fold(update, initialState)
      .map(render)
  }
}
```

---
name: pausev2
class: middle

<div style="float: right">
  {% include devoxx/pause-v2.svg %}
</div>


```javascript
function main({ time, DOM }) {

  const raf$ = time.animationFrames()

  const paused$ = DOM.select("document")
    .events("keyup")
    .filter(ev => ev.keyCode === 32)
    .fold(acc => !acc, false)

  return {
    DOM: time
      .animationFrames()
      .fold(update, initialState)
      .map(render)
  }
}
```

---
name: pausev3
class: middle

<div style="float: right">
  {% include devoxx/pause-v3.svg %}
</div>

```javascript
function main({ time, DOM }) {

  const raf$ = time.animationFrames()

  const paused$ = DOM.select("document")
    .events("keyup")
    .filter(ev => ev.keyCode === 32)
    .fold(acc => !acc, false)

  return {
    DOM: time
      .animationFrames()
      .combine(sampleCombine(pause$))
      .filter(([_, paused]) => !paused)
      .fold(update, initialState)
      .map(render)
  }
}
```

---
class: middle
# Testing

---
class: middle
layout: true

---
## Our app depends only on input signals

---
## Our app returns the side effects to execute

---
## Our app doesn't execute any side effects

---
## We are dealing with pure functions

---
# Test 1
## the app returns some `vDOM` when we feed it `animationFrames`

---
layout: false
name: test1
class: center, semi-condensed
# Testing

<div>
  {% include devoxx/test-1.svg %}
</div>

---
# Test 1

```javascript
const sources = {
  time: { animationFrames: () => xs.of(1) },
  DOM: mockDOMSource()
}

const { DOM } = main(sources)

DOM
  .addListener({
    next: function (vdom) {
      // assertion on the vdom
    },
    complete: done
  })
```

---
class: middle

# Test 2
## The app doesn't return any `vDOM` when paused

---
name: test2
class: center, semi-condensed
# Test 2

<div>
  {% include devoxx/test-2.svg %}
</div>

---
class: condensed

# Test 2

```javascript
const raf$   = time.diagram("-1|")
const pause$ = time.diagram("1-|")
```

--
```javascript
const domSource = mockDOMSource({
  "document": {
    keyup: pause$.map(toSpaceKeyup)
  }
})

const sources = {
  time: { animationFrames: raf$ },
  DOM: domSource
}
```

--

```javascript
const { DOM } = main(sources);

DOM.addListener({
  next: function (vdom) {
    // There must be a mistake, I am paused
  },
  complete: done
})
```

---
class: middle

# Applications' Architectures

---
name:resumearch
class: center
# My resume

<div>
  {% include devoxx/resumearch.svg %}
</div>

--
.animate-from-bottom[.middled.banner[`app()`]]

---
name:reactarch
class: center
# React

<div>
  {% include devoxx/reactarch.svg %}
</div>

--
.animate-from-bottom[.middled.banner[`const vdom = app()`]]

---
name:reduxarch
class: center
# React + Redux

<div>
  {% include devoxx/reduxarch.svg %}
</div>

--
.animate-from-bottom[.middled.banner[`const vdom = app(state)`]]

---
name:cyclearch
class: center
# Cycle.js

<div>
  {% include devoxx/cyclearch.svg %}
</div>

---
name:cyclearchext
class: center
# Cycle.js (fixed)

<div>
  {% include devoxx/cyclearch-ext.svg %}
</div>

--
.animate-from-bottom[.middled.banner[`const sideEffects = app(signals)`]]

---
layout: true
class: center, huge-code
# Cycle.js

---
```javascript
const sideEffects = application(signals)
```

---
```javascript
const sinks = application(sources)
```

---
```javascript
const sinks = application(time)
```

---
layout: false
# Cycle.js

```javascript
function main(sources) {
            // ↑ input signals

  /*...*/

  return {
    DOM: DOMOutput, // DOM's side effects I want to execute
    HTTP: HTTPOutput, // HTTP requests I want to execute
    /*...*/
  }
}
```

---
class: huge-code
# A vous !

```bash
$ npm install -g create-cycle-app
$ create-cycle-app cycle-rocks
```

---
name: me
class: center, middle, naked
![thomas belin](http://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=150)  
Thomas Belin  
Front-end developer @ <s>Mozilla</s> doyoubuzz  
<i class="ion-social-twitter"></i>
[@atomrc](https://twitter.com/atomrc) | [thomasbelin.fr](http://blog.thomasbelin.fr)

---
class: middle naked

# Thanks :)
## U 🤘

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.0/TweenMax.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.0/TimelineMax.min.js"></script>
    <script>
function once(initFn) {
  var output = null;
  return function init(slide) {
    if (output) {
      return output;
    }
    output = initFn(slide);
    return output;
  };

}

function functionAnimation(elm) {
  var timeline = new TimelineMax();

  timeline
    .to(elm, 1, { rotation: "-=360", transformOrigin: "center center"})

    return timeline;
}

function vibrate(elm) {
  var timeline = new TimelineMax();

  timeline
    .to(elm, .1, { rotation: "+=20", transformOrigin: "center center" })
    .to(elm, .1, { rotation: "-=40", transformOrigin: "center center" })
    .to(elm, .1, { rotation: "+=40", transformOrigin: "center center" })
    .to(elm, .1, { rotation: "-=40", transformOrigin: "center center" })
    .to(elm, .1, { rotation: "+=40", transformOrigin: "center center" })
    .to(elm, .1, { rotation: "-=20", transformOrigin: "center center" })

    return timeline;
}

var streamConf = {
  nf: 20,
  lf: 40,
  vlf: 160
};

var animations = {
  intro: once(function init(slide) {
    var timeline = new TimelineMax();
    var minTimeline = new TimelineMax();
    var hourTimeline = new TimelineMax();
    var eventTimeline = new TimelineMax();

    var min = slide.querySelectorAll(".time-min");
    var hour = slide.querySelectorAll(".time-hour");
    var streams = slide.querySelectorAll(".stream");

    minTimeline
      .to(min, 2, { rotation: 360, transformOrigin: "left bottom", ease: Power0.easeNone })
      .repeat(-1)

    hourTimeline
      .to(hour, 20, { rotation: 360, transformOrigin: "right bottom", ease: Power0.easeNone })
      .repeat(-1)

    eventTimeline
      .to(streams, .75, { strokeDashoffset:-15, ease: Power0.easeNone })
      .repeat(-1)

    timeline
      .add(minTimeline, "0")
      .add(hourTimeline, "0")
      .add(eventTimeline, "0")

    return timeline;
  }),

  mozescape: once(function (slide) {
    var timeline = new TimelineMax();
    var ball = document.querySelector(".pokeball")
    var moz = document.querySelector(".moz")

    timeline
      .to(ball, .25, { rotation: 20, transformOrigin: "center bottom", ease: Power0.easeNone })
      .to(ball, .25, { rotation: -10, transformOrigin: "center bottom", ease: Power0.easeNone })
      .to(ball, .25, { rotation: 5, transformOrigin: "center bottom", ease: Power0.easeNone })
      .to(ball, .25, { rotation: 0, transformOrigin: "center bottom", ease: Power0.easeNone })
      .to(ball, .25, { rotation: 20, transformOrigin: "center bottom", ease: Power0.easeNone }, "+=.5")
      .to(ball, .25, { rotation: -10, transformOrigin: "center bottom", ease: Power0.easeNone })
      .to(ball, .25, { rotation: 5, transformOrigin: "center bottom", ease: Power0.easeNone })
      .to(ball, .25, { rotation: 0, transformOrigin: "center bottom", ease: Power0.easeNone })
      .add("escape")
      .to(ball, .5, { scale: 5, opacity: 0 }, "escape")
      .to(moz, .5, { scale: 6, transformOrigin: "center center" }, "escape")
      .to(moz, 2, { x: -1000, opacity: 0 }, "+=.5")
      .repeat(-1)
    return timeline;
  }),

  beforecycle: once(function init(slide) {
    var timeline = new TimelineMax();
    var minTimeline = new TimelineMax();
    var hourTimeline = new TimelineMax();
    var eventTimeline = new TimelineMax();

    var min = slide.querySelectorAll(".time-min");
    var hour = slide.querySelectorAll(".time-hour");
    var ev = slide.querySelectorAll(".stream");

    minTimeline
      .to(min, 1, { rotation: 360, transformOrigin: "left bottom", ease: Power0.easeNone })
      .repeat(-1)

    hourTimeline
      .to(hour, 10, { rotation: 360, transformOrigin: "right bottom", ease: Power0.easeNone })
      .repeat(-1)

    eventTimeline
      .to(ev, .5, { strokeDashoffset:-streamConf.nf, ease: Power0.easeNone })
      .repeat(-1)

    timeline
      .add(minTimeline, "0")
      .add(hourTimeline, "0")
      .add(eventTimeline, "0")

    return timeline;
  }),

  aftercycle: once(function init(slide) {
    var timeline = new TimelineMax();
    var minTimeline = new TimelineMax();
    var hourTimeline = new TimelineMax();
    var eventTimeline = new TimelineMax();

    var min = slide.querySelectorAll(".time-min");
    var hour = slide.querySelectorAll(".time-hour");
    var ev = slide.querySelectorAll(".stream");

    minTimeline
      .to(min, 1, { rotation: 360, transformOrigin: "left bottom", ease: Power0.easeNone })
      .repeat(-1)

    hourTimeline
      .to(hour, 10, { rotation: 360, transformOrigin: "right bottom", ease: Power0.easeNone })
      .repeat(-1)

    eventTimeline
      .to(ev, .5, { strokeDashoffset:-streamConf.nf, ease: Power0.easeNone })
      .repeat(-1)

    timeline
      .add(minTimeline, "0")
      .add(hourTimeline, "0")
      .add(eventTimeline, "0")

      return timeline;
  }),

  pausev1: once(function init(slide) {
    var timeline = new TimelineMax();

    var raf = slide.querySelectorAll(".raf-stream");

    timeline
      .to(raf, 0.5, { strokeDashoffset:-streamConf.nf, ease: Power0.easeNone })
      .repeat(-1)

    return timeline;
  }),

  pausev2: once(function init(slide) {
    var timeline = new TimelineMax();

    var raf = slide.querySelectorAll(".raf-stream");
    var dom = slide.querySelectorAll(".dom-stream");

    var rafTl = new TimelineMax();

    domTl = new TimelineMax();

    domTl
      .to(dom, 1, { strokeDashoffset:-streamConf.lf, ease: Power0.easeNone })
      .repeat(-1)

    rafTl
      .to(raf, .5, { strokeDashoffset:-streamConf.nf, ease: Power0.easeNone })
      .repeat(-1)

    timeline
      .add(domTl, "0")
      .add(rafTl, "0")

    return timeline;
  }),

  pausev3: once(function init(slide) {
    var timeline = new TimelineMax();
    var rafTl = new TimelineMax();
    var domTl = new TimelineMax();
    var outTl = new TimelineMax();

    var raf = slide.querySelectorAll(".raf-stream");
    var dom = slide.querySelectorAll(".dom-stream");
    var out = slide.querySelectorAll(".out-stream");

    domTl
      .to(dom, 1.5, { strokeDashoffset:-36, ease: Power0.easeNone })
      .repeat(-1)

    outTl
      .to(out, 1.5, { strokeDashoffset:-50, ease: Power0.easeNone })
      .to(out, 0, { opacity: 0 })
      .repeatDelay(1.5)
      .repeat(-1)

    rafTl
      .to(raf, 5, { strokeDashoffset:-200, ease: Power0.easeNone })
      .repeat(-1)

    timeline
      .add(domTl, "0")
      .add(rafTl, "0")
      .add(outTl, "0")

    return timeline;
  }),

  test1: once(function init(slide) {
    var timeline = new TimelineMax();

    var ev = slide.querySelectorAll(".stream");
    var check = slide.querySelectorAll(".check");

    timeline
      .to(ev, 2, { strokeDashoffset:-170, ease: Power0.easeNone })
      .to(check, 1, { opacity: 1 })
      .repeat(-1)

      return timeline;
  }),

  test2: once(function init(slide) {
    var timeline = new TimelineMax();
    var rafTl = new TimelineMax();
    var domTl = new TimelineMax();

    var raf = slide.querySelectorAll(".raf-stream");
    var dom = slide.querySelectorAll(".dom-stream");
    var check = slide.querySelectorAll(".check");

    timeline
      .to(dom, 1, { strokeDashoffset:-120, ease: Power0.easeNone })
      .to(raf, 1, { strokeDashoffset:-120, ease: Power0.easeNone })
      .to(check, 1, { opacity: 1 })
      .repeat(-1)

      return timeline;
  }),

  resumearch: once(function init(slide) {
    var timeline = new TimelineMax();
    var outTl = new TimelineMax();
    var timeTl = new TimelineMax();

    var stream = slide.querySelectorAll(".stream");
    var out1 = slide.querySelectorAll(".sideeffect-1");
    var out2 = slide.querySelectorAll(".sideeffect-2");
    var out3 = slide.querySelectorAll(".sideeffect-3");

    timeTl
      .to(stream, 0.5, { strokeDashoffset:-streamConf.nf, ease: Power0.easeNone })
      .repeat(-1);

    outTl
      .to(out1, 0.75, { scale: 1.2, x: 40, opacity: 1, rotation: 360, transformOrigin: "center center" })
      .to(out1, 0, { opacity: 0})
      .to(out2, 0.75, { scale: 1.2, y: -20, x: 20, opacity: 1, rotation: 360, transformOrigin: "center center" }, 0.5)
      .to(out2, 0, { opacity: 0})
      .to(out3, 0.75, { scale: 1.2, y: 20, x: 20, opacity: 1, rotation: 360, transformOrigin: "center center" }, 1)
      .to(out3, 0, { opacity: 0})
      .repeat(-1)

    timeline
      .add(timeTl, "0")
      .add(outTl, "0")

    return timeline;
  }),

  reactarch: once(function init(slide) {
    var timeline = new TimelineMax();
    var outTl = new TimelineMax();
    var timeTl = new TimelineMax();

    var stream = slide.querySelectorAll(".stream");
    var out = slide.querySelectorAll(".output");

    timeTl
      .to(stream, 0.5, { strokeDashoffset:-streamConf.nf, ease: Power0.easeNone })
      .repeat(-1);

    outTl
      .to(out, 3, { x: 100, opacity: 1 })
      .repeat(-1)

    timeline
      .add(timeTl, "0")
      .add(outTl, "0")

    return timeline;
  }),

  reduxarch: once(function init(slide) {
    var timeline = new TimelineMax();
    var outTl = new TimelineMax();
    var timeTl = new TimelineMax();

    var stream = slide.querySelectorAll(".stream");
    var state = slide.querySelectorAll(".state");
    var out = slide.querySelectorAll(".output");

    timeTl
      .to(stream, 0.5, { strokeDashoffset:-streamConf.nf, ease: Power0.easeNone })
      .repeat(-1);

    outTl
      .to(state, 2, { x: 90, opacity: 1 })
      .to(out, 2, { x: 90, opacity: 1 })
      .repeat(-1)

    timeline
      .add(timeTl, "0")
      .add(outTl, "0")

    return timeline;
  }),

  cyclearch: once(function init(slide) {
    var timeline = new TimelineMax();
    var functionTl = new TimelineMax();
    var timeTl = new TimelineMax();

    var stream = slide.querySelectorAll(".stream");
    var func = slide.querySelectorAll(".function");

    functionTl
      .add(functionAnimation(func))
      .repeat(-1)

    timeTl
      .to(stream, 0.5, { strokeDashoffset:-streamConf.nf, ease: Power0.easeNone })
      .repeat(-1);

    timeline
      .add(timeTl, "0")
      .add(functionTl, "0")

    return timeline;
  }),

  cyclearchext: once(function init(slide) {
    var timeline = new TimelineMax();

    var hourTimeline = new TimelineMax();
    var minTimeline = new TimelineMax();
    var timeTl = new TimelineMax();

    var min = slide.querySelectorAll(".time-min");
    var hour = slide.querySelectorAll(".time-hour");

    var stream = slide.querySelectorAll(".stream");

    minTimeline
      .to(min, 2, { rotation: 360, transformOrigin: "left bottom", ease: Power0.easeNone })
      .repeat(-1)

    hourTimeline
      .to(hour, 20, { rotation: 360, transformOrigin: "right bottom", ease: Power0.easeNone })
      .repeat(-1)

    timeTl
      .to(stream, 4, { strokeDashoffset:-streamConf.vlf, ease: Power0.easeNone })
      .repeat(-1);

    timeline
      .add(hourTimeline, "0")
      .add(minTimeline, "0")
      .add(timeTl, "0")

    return timeline;
  })
};
    </script>
    <script>
      //init remarkjs
      var timeout = window.setTimeout;
      var slideshow = remark.create({
        highlightStyle: 'github',
        highlightLines: true,
        ratio: "16:9"
      });

      slideshow.on("beforeHideSlide", function (slide) {
        var currentSlide = document.querySelector(".remark-slide-container.entered");
        var animation = animations[slide.properties.name] ? animations[slide.properties.name](currentSlide) : null;
        if (animation) {
          animation.pause();
        }
        if (!currentSlide) { return; }
        currentSlide.classList.remove("entered");
      });

      slideshow.on("afterShowSlide", function (slide) {
        timeout(launchAnimations, 50, slide);
      });

      timeout(
        launchAnimations,
        50,
        slideshow.getSlides()[slideshow.getCurrentSlideIndex()]
      );

      function launchAnimations(slide) {
          var element = document.querySelector(".remark-visible");
          element.classList.add("entered");
          var animation = animations[slide.properties.name] ? animations[slide.properties.name](element) : null;
          if (animation) {
            animation.play();
          }
          return animation
      }

      document.addEventListener("keyup", function (ev) {
        if (ev.keyCode === 84) {
          var currentSlide = document.querySelector(".remark-slide-container.entered");
          currentSlide.classList.toggle("toggled");
        }
      });

    </script>

    <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-34218773-1', { siteSpeedSampleRate: 100 });
ga('send', 'pageview');
    </script>

  </body>
</html>
